<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Project Lab 15. 유효성 검사(javascript) - 1" /><meta property="og:locale" content="en" /><meta name="description" content="Java를 사용하여 입력값(text, file) 유효성 검사 과정을 소개한다." /><meta property="og:description" content="Java를 사용하여 입력값(text, file) 유효성 검사 과정을 소개한다." /><link rel="canonical" href="https://scribnote5.github.io/posts/Project-Lab15/" /><meta property="og:url" content="https://scribnote5.github.io/posts/Project-Lab15/" /><meta property="og:site_name" content="끄적이판" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-23T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Project Lab 15. 유효성 검사(javascript) - 1" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Java를 사용하여 입력값(text, file) 유효성 검사 과정을 소개한다.","url":"https://scribnote5.github.io/posts/Project-Lab15/","headline":"Project Lab 15. 유효성 검사(javascript) - 1","@type":"BlogPosting","dateModified":"2021-06-16T00:00:00+09:00","datePublished":"2020-09-23T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://scribnote5.github.io/posts/Project-Lab15/"},"@context":"https://schema.org"}</script><title>Project Lab 15. 유효성 검사(javascript) - 1 | 끄적이판</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="끄적이판"><meta name="application-name" content="끄적이판"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/banners/home.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">끄적이판</a></div><div class="site-subtitle font-italic">지금까지 공부한 것을 끄적이는 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/scribnote5" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['scribnote5','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/daeyoung-song-175486167" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Project Lab 15. 유효성 검사(javascript) - 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Project Lab 15. 유효성 검사(javascript) - 1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> scribnote5 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 23, 2020, 12:00 AM +0900" >Sep 23, 2020<i class="unloaded">2020-09-23T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 16, 2021, 12:00 AM +0000" >Jun 16, 2021<i class="unloaded">2021-06-16T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6262 words">34 min read</span></div></div><div class="post-content"><ul><li><p>Java를 사용하여 입력값(text, file) 유효성 검사 과정을 소개한다.</p><li>github: <a href="https://github.com/scribnote5/lab">https://github.com/scribnote5/lab</a><li><p>github commit: <a href="https://github.com/scribnote5/lab/commit/b145d6864452592f86448ba92d54ddaaf0d0867a">https://github.com/scribnote5/lab/commit/b145d6864452592f86448ba92d54ddaaf0d0867a</a></p><li>최신 프로젝트 코드와 형상이 다를 수 있습니다. 게시글 코드는 참고만 하시되, 최신 코드는 github에서 확인 부탁드립니다.</ul><h2 id="java-bean-유효성-검사spring-boot-starter-validation">Java bean 유효성 검사(spring-boot-starter-validation)</h2><ul><li>Bean Validation 2.0(JSR-380)은 Java 데이터 유효성 검사 표준 기술로, 애노테이션을 사용하여 bean 유효성 검사를 하는 Java API 명세다.<li>Hibernate-validator: Bean Validation을 구현한 Java API다.<li>프로젝트에서는 Bean Validation 2.0 API를 사용하여 Java 유효성 검사를 수행한다. spring-boot-starter-validation 의존성에는 Bean Validation 2.0 API와 이를 구현한 Hibernate-validator API가 존재한다.</ul><p>출처: <a href="https://medium.com/@SlackBeck/javabean-validation%EA%B3%BC-hibernate-validator-%EA%B7%B8%EB%A6%AC%EA%B3%A0-spring-boot-3f31aee610f5">https://medium.com/@SlackBeck/javabean-validation%EA%B3%BC-hibernate-validator-%EA%B7%B8%EB%A6%AC%EA%B3%A0-spring-boot-3f31aee610f5</a></p><ul><li>javax annotation으로 validation 방법은 하단 출처를 참고하였다.</ul><p>출처: <a href="https://jeong-pro.tistory.com/203">https://jeong-pro.tistory.com/203</a></p><h2 id="파일-유효성-검사파일-크기-파일-확장자-mime-type">파일 유효성 검사(파일 크기, 파일 확장자, MIME Type)</h2><ul><li>기본적인 파일 validation 방법은 파일 확장자를 검사하는 방법이다. 보안 위협이 될 수 있는 확장자를 가지는 파일(.exe 파일, .jar 파일)이 서버에 업로드 되지 않도록 차단한다.<li>그러나 파일 확장자가 .txt 고 보안 공격을 시도하는 파일 binary 구조를 가진다면, 큰 보안 위협이 된다. 벡엔드에서는 .txt 파일 확장자를 유효한 파일 확장자라고 판단하여 파일 업로드를 허용하기 때문이다. 이렇듯 웹에서 파일 확장자는 큰 의미를 가지지 않으며, 파일 MIME type을 사용한 파일 유효성 검사가 필요하다.<li>MIME(Multipurpose Internet Mail Extensions) type은 웹에서 클라이언트에게 전송된 문서의 다양성을 알려주기 위한 메커니즘으로서, 첨부된 파일을 텍스트 문자 형태로 변환해서 이메일과 함께 전송하기 위해 개발된 포맷이다. 파일의 MIME type을 분석한다면, 위에서 설명한 보안 위협 사례를 예방할 수 있다.<li>프로젝트에서는 파일 확장자, 파일 크기(한 번 업로드시 20MB 이하의 파일만 업로드 허용), MIME type을 사용하여 유효성 검사를 수행한다. 다양한 파일 MIME type 확인 방법 중에서, Apache Tika 라이브러리를 사용하였다.</ul><p>출처: <a href="https://offbyone.tistory.com/330">https://offbyone.tistory.com/330</a><br /> <a href="https://www.baeldung.com/java-file-mime-type">https://www.baeldung.com/java-file-mime-type</a><br /> <a href="https://stackoverflow.com/questions/5541694/how-to-get-file-extension-from-content-type">https://stackoverflow.com/questions/5541694/how-to-get-file-extension-from-content-type</a></p><h2 id="예외처리-설계">예외처리 설계</h2><ul><li>Spring에서 예외처리 방법에는 3가지가 있다.<li>전역에서 예외처리(전체 애플리케이션) Global Level using - @ControllerAdvice<li>Controller에서 예외처리 Controller Level using - @ExceptionHandler<li>메소드에서 예외처리 Method Level using - try- catch</ul><p>출처: <a href="https://jeong-pro.tistory.com/195">https://jeong-pro.tistory.com/195</a><br /> <a href="https://springboot.tistory.com/33">https://springboot.tistory.com/33</a></p><h3 id="전역에서-예외처리-controlleradvice">전역에서 예외처리 @ControllerAdvice</h3><ul><li>프로젝트에서는 애플리케이션에서 발생하는 예외는 전역에서 예외처리하여 에러 메시지를 응답한다.<li>Bean Validation 2.0 API의 유효성 검사에 실패하면 예외 정보를 Controller 파라미터에 BindingResult bindingResult를 선언 후 bindingResult.hasError() 메소드를 사용하여 확인할 수 있다.<li>그러나 해당 방법은 모든 응답마다 유효성 검사를 위한 소스 코드가 추가되기에 비효율적이므로, 유효성 검사에 실패하면 발생하는 예외를 전역에서 예외처리 하도록 구현하였다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">test</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/books"</span><span class="o">)</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nd">@Valid</span> <span class="nc">AddBookRequestDto</span> <span class="n">addBookRequestDto</span><span class="o">,</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span>
    <span class="o">{</span>
        <span class="n">bindingResult</span><span class="o">.</span><span class="na">getAllErrors</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">objectError</span><span class="o">-&gt;{</span> <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"code : "</span> <span class="o">+</span> <span class="n">objectError</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span> <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"defaultMessage : "</span> <span class="o">+</span> <span class="n">objectError</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">());</span> <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"objectName : "</span> <span class="o">+</span> <span class="n">objectError</span><span class="o">.</span><span class="na">getObjectName</span><span class="o">());</span> <span class="o">});</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">bookService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">addBookRequestDto</span><span class="o">.</span><span class="na">toEntity</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>출처: <a href="https://velog.io/@hellozin/Valid-%EC%98%88%EC%99%B8%EB%A5%BC-%EC%A0%84%EC%97%AD-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%98%EA%B2%8C-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0">https://velog.io/@hellozin/Valid-%EC%98%88%EC%99%B8%EB%A5%BC-%EC%A0%84%EC%97%AD-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EB%A1%9C-%EA%B0%84%EB%8B%A8%ED%95%98%EA%B2%8C-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0</a></p><h3 id="controller에서-예외처리-exceptionhandler">Controller에서 예외처리 @ExceptionHandler</h3><ul><li>Controller내에서 발생하는 모든 예외를 처리하는 방법이다. 전역에서 예외처리 하는 방법은 소스 코드 중복을 줄이고 가독성을 향상시키므로, 해당 방법을 적용하지 않았다. 메소드에서 예외처리 try-catch<li>메소드에서 예외처리 방법은 예외마다 다르게 처리할 수 있고 메소드 단위로 예외처리를 수행하기 때문에 소스 코드의 안전성과 신뢰성을 높일 수 있다. 그러나 반복되는 try-catch 구문은 가독성을 떨어뜨리고 알고리즘 로직의 흐름이 끊긴다.<li>하단 출처에서는 try-cath 사용할 때 전략을 다음과 같이 소개한다.<ol><li>try-catch를 최대한 지양해라.<li>try-catch로 에러를 먹고 죽는 코드는 지양해라.(이런 코드가 있다면 로그라도 추가해주세요…) try { // 비즈니스 로직 수행… }catch (Exception e){ e.printStackTrace(); }<li>try catch를 사용하게 된다면 더 구체적인 Exception을 발생시키는 것이 좋다.</ol></ul><p>출처: <a href="https://cheese10yun.github.io/spring-guide-exception/">https://cheese10yun.github.io/spring-guide-exception/</a></p><h2 id="의존성-관리">의존성 관리</h2><ul><li>Java bean 유효성 검사를 위한 spring-boot-starter-validation 의존성과 파일 유효성 검사(MIME Type)에 필요한 Apache Tika 의존성을 추가한다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>&lt;build.gradle&gt;

   // 프로젝트 개발에 필요한 공통 의존성 라이브러리를 선언한다.
   dependencies {
       // spring boot
       implementation "org.springframework.boot:spring-boot-starter-web"
       implementation "org.springframework.boot:spring-boot-starter-data-jpa"
       implementation "org.springframework.boot:spring-boot-starter-security"
       implementation "org.springframework.boot:spring-boot-starter-validation"
       runtimeOnly "org.springframework.boot:spring-boot-devtools"

       ...
   }
}

...

project(":module-domain-core") {
   dependencies {
       compile project(":module-system-common")

       implementation "org.apache.tika:tika-parsers:1.24.1"
       implementation "com.querydsl:querydsl-core"
       implementation "com.querydsl:querydsl-jpa"
   }
}

...
</pre></table></code></div></div><h2 id="config">Config</h2><ul><li>Web 애플리케이션의 설정 및 공통적으로 사용하는 Web Resource를 다루는 모듈을 추가하였다.<li>해당 모듈은 프로젝트 진행 중 각 역할을 세분화하고 모듈간의 의존성을 낮추기 위해서 새로 추가하였으며, 이후 모듈의 역할을 구체적으로 정하고 세분화 작업을 수행할 예정이다.<li>Error 클래스, Handler 클래스, Validation 클래스, module-web-core와 module-app-admin이 공통적으로 사용하는 Web Resources(html, css, javascript 등) 파일이 위치한다. Web Resource는 추후 리펙토링 때 분리할 예정이다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>&lt;settings.gradle&gt;

rootProject.name = 'lab'
include 'module-system-common'
include 'module-domain-core'
include 'module-app-api'
include 'module-app-web'
include 'module-app-admin'
include 'module-web-core'
</pre></table></code></div></div><p><br /></p><ul><li>max-swallow-size: 요청 body의 크기를 설정한다. 업로드되는 파일 크기가 제한(20MB)을 초과하여 예외가 발생하는 경우, 사용자 정의 예외처리 방식으로 수행되도록 한다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>&lt;module-app-api/src/main/resources/application.yml&gt;

spring:
 jpa:
   open-in-view: false
 devtools:
   # 프론트 수정 사항을 자동으로 반영한다.
   livereload:
     enabled: false
 servlet:
   multipart:
     # 한개의 파일의 최대 크기
     max-file-size: 20MB
     # form-data 요청에 따른 모든 파일의 최대 크기
     max-request-size: 20MB
     enabled: true
server:
 tomcat:
   max-swallow-size: -1
...
</pre></table></code></div></div><h2 id="java-bean-유효성-검사">Java bean 유효성 검사</h2><ul><li>게시글에서는 noticeBoard 게시판을 기준으로 소개한다.<li>모든 DTO에서 공통적으로 사용하는 DTO다.<li>private String createdBy: @NotBlank 생성자 데이터가 공란인지 유효성 검사한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">dto</span><span class="o">/</span><span class="nc">CommonDto</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.common.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.domain.enums.ActiveStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonDto</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">lastModifiedDate</span><span class="o">;</span>
   <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"The createdBy must not be blank.\nIf the message is alerted although you are logged in, please contact the admin."</span><span class="o">)</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastModifiedBy</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">ActiveStatus</span> <span class="n">activeStatus</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isAccess</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>NoticeBoard에서 사용하는 DTO다.<li>private String title: @NotBlank 제목 데이터가 공란인지 유효성 검사한다.<li>private String content: @Editor은 사용자 정의 validaton(ConstraintValidator)이다. editor 멤버 필드의 byte 크기가 16MB 이하인지 유효성 검사한다.</ul><p>출처: <a href="https://cheese10yun.github.io/ConstraintValidator/">https://cheese10yun.github.io/ConstraintValidator/</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">dto</span><span class="o">/</span><span class="nc">NoticeBoardDto</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.CommonDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.common.validation.Editor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardAttachedFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardDto</span> <span class="kd">extends</span> <span class="nc">CommonDto</span> <span class="o">{</span>
   <span class="cm">/* CommonDto: JPA Audit */</span>

   <span class="cm">/* 기본 정보 */</span>
   <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"The title must not be blank."</span><span class="o">)</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
   <span class="nd">@Editor</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="mi">16777215</span><span class="o">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"The editor's input size of bytes is exceeded."</span><span class="o">)</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">Long</span> <span class="n">viewCount</span><span class="o">;</span>

   <span class="cm">/* newIcon */</span>
   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isNewIcon</span><span class="o">;</span>

   <span class="cm">/* 첨부 파일 */</span>
   <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">NoticeBoardAttachedFile</span><span class="o">&gt;</span> <span class="n">attachedFileList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoticeBoardAttachedFile</span><span class="o">&gt;();</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>사용자 정의 validaton(ConstraintValidator)의 애노테이션을 생성한다.<li>String message(): @Editor를 통해 입력되는 message다.<li>long max(): @Editor를 통해 입력되는 최대 byte 크기다. byte 크기를 제한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="nc">Editor</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.common.validation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.Constraint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Payload</span><span class="o">;</span>

<span class="nd">@Documented</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="nc">EditorValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span> <span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Editor</span> <span class="o">{</span>
   <span class="nc">String</span> <span class="nf">message</span><span class="o">();</span>
   <span class="kt">long</span> <span class="nf">max</span><span class="o">();</span>
   <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
   <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>사용자 정의 validaton(ConstraintValidator)의 유효성 검사 로직이 존재한다.<li>initialize: @Editor를 통해 입력되는 최대 byte 크기를 초기화 한다.<li>long max(): ConstraintValidator의 유효성 검사 로직이다. byte 크기가 16MB 이하인지 유효성 검사한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="nc">EditorValidator</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.common.validation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.util.ByteSizeUtil</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.ConstraintValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.ConstraintValidatorContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EditorValidator</span> <span class="kd">implements</span> <span class="nc">ConstraintValidator</span><span class="o">&lt;</span><span class="nc">Editor</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="kt">long</span> <span class="n">max</span><span class="o">;</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">Editor</span> <span class="n">editor</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">max</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="na">max</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">,</span> <span class="nc">ConstraintValidatorContext</span> <span class="n">cxt</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="nc">ByteSizeUtil</span><span class="o">.</span><span class="na">getByteSize</span><span class="o">(</span><span class="n">str</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">max</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>Java: 문자열의 byte 크기를 반환한다.</ul><p>출처: <a href="https://photoress.tistory.com/entry/String%ED%98%95-Bytes%EB%A1%9C-length%EA%B5%AC%ED%95%98%EA%B8%B0">https://photoress.tistory.com/entry/String%ED%98%95-Bytes%EB%A1%9C-length%EA%B5%AC%ED%95%98%EA%B8%B0</a><br /> <a href="https://blog.miyam.net/125">https://blog.miyam.net/125</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="nc">ByteSizeUtil</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ByteSizeUtil</span> <span class="o">{</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getByteSize</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
       <span class="kt">int</span> <span class="n">byteSize</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

       <span class="k">try</span> <span class="o">{</span>
           <span class="n">byteSize</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">).</span><span class="na">length</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">byteSize</span><span class="o">;</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>NoticeBoard 관련 클라이언트의 요청을 json 타입으로 응답한다.<li>@Valid를 사용하면 View에서 전달되는 데이터에 대해서 유효성 검사가 수행된다. 만약 NoticeBoardDto 유효성 검사에 실패하여 예외가 발생한다면, 해당 예외는 전역에서 예외처리 된다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">NoticeBoardRestController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.validation.FileValidator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorCode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.exception.FileTypeException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.mapper.NoticeBoardMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardAttachedFileService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MaxUploadSizeExceededException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/notice-boards"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardRestController</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardService</span> <span class="n">noticeBoardService</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardAttachedFileService</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">NoticeBoardRestController</span><span class="o">(</span><span class="nc">NoticeBoardService</span> <span class="n">noticeBoardService</span><span class="o">,</span> <span class="nc">NoticeBoardAttachedFileService</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardService</span> <span class="o">=</span> <span class="n">noticeBoardService</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardAttachedFileService</span> <span class="o">=</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@PostMapping</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">postNoticeBoard</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nd">@Valid</span> <span class="nc">NoticeBoardDto</span> <span class="n">noticeBoardDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">Long</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">insertNoticeBoard</span><span class="o">(</span><span class="n">noticeBoardDto</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">idx</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">"/{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">putNoticeBoard</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"idx"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="nd">@Valid</span> <span class="nc">NoticeBoardDto</span> <span class="n">noticeBoardDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">updateNoticeBoard</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">noticeBoardDto</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"{}"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"/{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">deleteNoticeBoard</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"idx"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">deleteNoticeBoardByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
       <span class="n">noticeBoardAttachedFileService</span><span class="o">.</span><span class="na">deleteAllAttachedFile</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"{}"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="파일-유효성-검사파일-확장자-mime-type">파일 유효성 검사(파일 확장자, MIME Type)</h2><ul><li>유효하지 않은 파일 확장자, MIME type 데이터를 static 키워드로 선언된 Set Collection 멤버 필드에 초기화한다.<li>파일 유효성 검사를 위한 파일 확장자와 MIME type 리스트는 하단 출처를 참고하여 정리하였다.</ul><p>출처: <a href="https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/">https://www.howtogeek.com/137270/50-file-extensions-that-are-potentially-dangerous-on-windows/</a><br /> <a href="https://kb.intermedia.net/article/23567">https://kb.intermedia.net/article/23567</a><br /> <a href="https://www.file-extensions.org/filetype/extension/name/dangerous-malicious-files">https://www.file-extensions.org/filetype/extension/name/dangerous-malicious-files</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="nc">FileType</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.common.validation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileType</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">invalidMimeTypeSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">invalidExtensionSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">validImageTypeSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>

   <span class="c1">// Invalid mime type Set</span>
   <span class="kd">static</span> <span class="o">{</span>
       <span class="c1">// Application</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/x-msdownload"</span><span class="o">);</span> <span class="c1">// .exe</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/x-msdownload; format=pe32"</span><span class="o">);</span> <span class="c1">// .exe</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/java-archive"</span><span class="o">);</span> <span class="c1">// .jar</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/javascript"</span><span class="o">);</span> <span class="c1">// .js</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/x-shockwave-flash"</span><span class="o">);</span> <span class="c1">// .swf</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/octet-stream"</span><span class="o">);</span> <span class="c1">// .bin 등의 실행 파일</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/x-msmetafile"</span><span class="o">);</span> <span class="c1">// .wmf</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/java-vm"</span><span class="o">);</span> <span class="c1">// .class</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/vnd.ms-htmlhelp"</span><span class="o">);</span> <span class="c1">// .chm</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/x-portable-graymap"</span><span class="o">);</span> <span class="c1">// .pgm</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/x-pcx"</span><span class="o">);</span> <span class="c1">// .pcx</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/winhlp"</span><span class="o">);</span> <span class="c1">// .hlp</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/vnd.americandynamics.acc"</span><span class="o">);</span> <span class="c1">// .acc</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"text/css"</span><span class="o">);</span> <span class="c1">// .css</span>
       <span class="n">invalidMimeTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"application/x-sh"</span><span class="o">);</span> <span class="c1">//.sh</span>
   <span class="o">}</span>

   <span class="c1">// Invalid Extension Set</span>
   <span class="kd">static</span> <span class="o">{</span>
       <span class="c1">// Programs</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".pif"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".gadget"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msi"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".com"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".hta"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cpl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msc"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".exe"</span><span class="o">);</span>
       <span class="c1">// Scripts</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bat"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cmd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vb"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vbs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vbe"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".jse"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ws"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".wsf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".wsc"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".wsh"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ps1"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ps2"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ps1xml"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ps2xml"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".psc1"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".psc2"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msh"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msh1"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msh2"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mshxml"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msh1xml"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".msh2xml"</span><span class="o">);</span>
       <span class="c1">// Shortcuts</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".scf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".lnk"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".inf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".reg"</span><span class="o">);</span>
       <span class="c1">// Others</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dll"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".sys"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".gzquar"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".zix"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".aru"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ozd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".drv"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".sjs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dev"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xlm"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".0_full_0_tgod_signed"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".boo"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".tps"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".tsa"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".sop"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bkd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cih"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".iik"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dyz"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dyv"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".kcd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".s7p"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"dlb"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".9"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dom"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".php3"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dxz"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mjg"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mfu"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cla"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".hlw"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".rsc_tmp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mjz"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bup"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".upa"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bhx"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mcq"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dli"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".txs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".fnr"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xir"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xlv"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bxz"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cxq"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xdu"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ska"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".wlpginstall"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cfxxe"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".tti"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vexe"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".qrn"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dllx"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".faq"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xtbl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".smtmp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ceo"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".tko"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".uzy"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".oar"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bll"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".plc"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".spam"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ssy"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dbd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".smm"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ce0"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".zvz"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cc"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".blf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ctbl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".iws"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vzr"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".nls"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".hsq"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".lkh"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".aepl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".rna"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".hts"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".let"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".aut"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".delf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".buk"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".fuj"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".atm"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ezt"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".fjl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bmw"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dx"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".cyw"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".iva"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".pid"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bps"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".capxml"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".bqf"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".pr"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".qit"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".xnt"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".lpaq5"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".lok"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".shs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".mcs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".dmg"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".grp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ocx"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ovl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vdl"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".vxd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".asp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".htx"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".php"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".crt"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".ins"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".isp"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".sbs"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".sct"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".shb"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".shd"</span><span class="o">);</span>
       <span class="n">invalidExtensionSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">".wst"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="c1">// Valid image mime type set</span>
   <span class="kd">static</span> <span class="o">{</span>
       <span class="n">validImageTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/jpeg"</span><span class="o">);</span> <span class="c1">// .jpg, .jpeg</span>
       <span class="n">validImageTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/x-citrix-jpeg"</span><span class="o">);</span> <span class="c1">// .jpg, .jpeg</span>
       <span class="n">validImageTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/png"</span><span class="o">);</span> <span class="c1">//.png</span>
       <span class="n">validImageTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/x-citrix-png"</span><span class="o">);</span> <span class="c1">//.png</span>
       <span class="n">validImageTypeSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"image/x-png"</span><span class="o">);</span> <span class="c1">//.png</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>MIME type, 파일 확장자 유효성 검사가 수행된다. Apache Tika 라이브러리를 사용하여 파일의 MIME type을 유효성 검사하고, 이후 파일 확장자를 유효성 검사한다.<li>만약 MIME type과 파일 확장자 유효성 검사에 실패한다면 에러 메시지가 Controller에 반환되고, 유효성 검사에 성공한다면 “valid” 문자열이 반환된다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="nc">FileValidator</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.common.validation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.util.FileUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tika.Tika</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileValidator</span> <span class="o">{</span>
   <span class="cm">/**
    * file type이 유효한지 검사
    *
    * @param files
    * @return
    * @throws IOException
    */</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">isFileValid</span><span class="o">(</span><span class="nc">MultipartFile</span><span class="o">[]</span> <span class="n">files</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
       <span class="nc">Tika</span> <span class="n">tika</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tika</span><span class="o">();</span>
       <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">"valid"</span><span class="o">;</span>

       <span class="k">for</span> <span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span> <span class="o">:</span> <span class="n">files</span><span class="o">)</span> <span class="o">{</span>
           <span class="nc">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="n">tika</span><span class="o">.</span><span class="na">detect</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
           <span class="nc">String</span> <span class="n">extension</span> <span class="o">=</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">());</span>

           <span class="k">if</span> <span class="o">(</span><span class="nc">FileType</span><span class="o">.</span><span class="na">invalidMimeTypeSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">mimeType</span><span class="o">))</span> <span class="o">{</span>
               <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">mimeType</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">extension</span><span class="o">);</span>
               <span class="n">result</span> <span class="o">=</span> <span class="s">"The file "</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">()</span> <span class="o">+</span> <span class="s">" [mime type: "</span> <span class="o">+</span> <span class="n">mimeType</span> <span class="o">+</span> <span class="s">"] doesn't support to upload because it supposed to dangerous and malicious."</span><span class="o">;</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="o">}</span>

           <span class="k">if</span> <span class="o">(</span><span class="nc">FileType</span><span class="o">.</span><span class="na">invalidExtensionSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">extension</span><span class="o">))</span> <span class="o">{</span>
               <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">mimeType</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">extension</span><span class="o">);</span>
               <span class="n">result</span> <span class="o">=</span> <span class="s">"The file "</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">()</span> <span class="o">+</span> <span class="s">" [extension: "</span> <span class="o">+</span> <span class="n">extension</span> <span class="o">+</span> <span class="s">"] doesn't support to upload because it supposed to dangerous and malicious."</span><span class="o">;</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">isImageFileValid</span><span class="o">(</span><span class="nc">MultipartFile</span><span class="o">[]</span> <span class="n">files</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
       <span class="nc">Tika</span> <span class="n">tika</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tika</span><span class="o">();</span>
       <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">"valid"</span><span class="o">;</span>

       <span class="k">for</span> <span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span> <span class="o">:</span> <span class="n">files</span><span class="o">)</span> <span class="o">{</span>
           <span class="nc">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="n">tika</span><span class="o">.</span><span class="na">detect</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
           <span class="nc">String</span> <span class="n">extension</span> <span class="o">=</span> <span class="nc">FileUtil</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">());</span>

           <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">mimeType</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">extension</span><span class="o">);</span>

           <span class="k">if</span> <span class="o">(!</span><span class="nc">FileType</span><span class="o">.</span><span class="na">validImageTypeSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">mimeType</span><span class="o">))</span> <span class="o">{</span>
               <span class="n">result</span> <span class="o">=</span> <span class="s">"The file "</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">()</span> <span class="o">+</span> <span class="s">"[mimet ype: "</span> <span class="o">+</span> <span class="n">mimeType</span> <span class="o">+</span> <span class="s">"] doesn't support to upload because it supposed to not image type."</span><span class="o">;</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>NoticeBoard 관련 클라이언트의 요청을 json 타입으로 응답한다.<li>View에서 전달되는 파일에 대해서 MimeType과 파일 확장자 유효성 검사가 수행된다.<li>MimeType과 파일 확장자 유효성 검사에 실패한다면(Service에서 반환한 문자열이 에러 메시지인 경우), FileTypeException 예외가 발생하고 해당 예외는 전역에서 예외처리 된다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">NoticeBoardRestController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="o">...</span>

    <span class="c1">// 첨부 파일 업로드</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/attachedFile"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">uploadAttachedFile</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">MultipartFile</span><span class="o">[]</span> <span class="n">files</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">fileValidationResult</span> <span class="o">=</span> <span class="nc">FileValidator</span><span class="o">.</span><span class="na">isFileValid</span><span class="o">(</span><span class="n">files</span><span class="o">);</span>

        <span class="c1">// 파일 mime type 검사</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"valid"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">fileValidationResult</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">FileTypeException</span><span class="o">(</span><span class="n">fileValidationResult</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">noticeBoardAttachedFileService</span><span class="o">.</span><span class="na">uploadAttachedFile</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">createdBy</span><span class="o">,</span> <span class="n">files</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"{}"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">...</span>
</pre></table></code></div></div><h2 id="예외처리">예외처리</h2><ul><li>메소드 또는 컨트롤로러에서 예외를 처리하지 못한다면, @RestControllerAdvice 애노테이션이 선언된 클래스가 전역에서 예외처리를 수행된다.<li>메소드에 선언된 @ExceptionHandler 애노테이션 통하여 지정한 예외를 처리한다.<li>또한 사용자에게 전달되는 예외 메시지가 일관성을 가지기 위해서, 예외 데이터를 저장하는 ErrorResponse 클래스를 생성하였다. 예외 관련 데이터는 ErrorResponse 클래스에 초기화된 다음 클라이언트에 응답한다.<li>각 예외에 대한 설명은 주석을 참고하면 된다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">handler</span><span class="o">/</span><span class="nc">GlobalExceptionHandler</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorCode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.exception.BusinessException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.exception.FileTypeException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.access.AccessDeniedException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.HttpRequestMethodNotSupportedException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.MethodArgumentNotValidException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.annotation.MethodArgumentTypeMismatchException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MaxUploadSizeExceededException</span><span class="o">;</span>

<span class="nd">@RestControllerAdvice</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="o">{</span>
   <span class="cm">/**
    * @Valid binding error가 발생할 때 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleMethodArgumentNotValidException</span><span class="o">(</span><span class="nc">MethodArgumentNotValidException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleMethodArgumentNotValidException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_INPUT_VALUE</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">());</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * @ModelAttribute bindingResult error가 발생할 때 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">BindException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleBindException</span><span class="o">(</span><span class="nc">BindException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleBindException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_TYPE_VALUE</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">());</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * enum type binding error가 발생할 때 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">MethodArgumentTypeMismatchException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleMethodArgumentTypeMismatchException</span><span class="o">(</span><span class="nc">MethodArgumentTypeMismatchException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleMethodArgumentTypeMismatchException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 지원하지 않은 HTTP method를 호출 할 때 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">HttpRequestMethodNotSupportedException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleHttpRequestMethodNotSupportedException</span><span class="o">(</span><span class="nc">HttpRequestMethodNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleHttpRequestMethodNotSupportedException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">METHOD_NOT_ALLOWED</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">METHOD_NOT_ALLOWED</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * Authentication 객체가 필요한 권한을 보유하지 않은 경우 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">AccessDeniedException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleAccessDeniedException</span><span class="o">(</span><span class="nc">AccessDeniedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleAccessDeniedException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">HANDLE_ACCESS_DENIED</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">HANDLE_ACCESS_DENIED</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()));</span>
   <span class="o">}</span>

   <span class="cm">/**
    * multipart에서 설정한 file size보다 큰 파일이 업로드 되는 경우 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">MaxUploadSizeExceededException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">handleMaxUploadSizeExceededException</span><span class="o">(</span><span class="nc">MaxUploadSizeExceededException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleMaxUploadSizeExceededException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">FILE_SIZE_ERROR</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * file type이 위험하고 악의적인 것으로 판별되는 경우 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">FileTypeException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">handleFileTypeException</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleFileTypeException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">FILE_TYPE_ERROR</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 비즈니스 요구사항에 따른 Exception
    * 비즈니스 요구사항에 예외일 경우 BusinessException으로 통일성 있게 처리
    * 추가로 늘어날 수는 있지만 exception 개수를 최소화 해야함
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">BusinessException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleBusinessException</span><span class="o">(</span><span class="kd">final</span> <span class="nc">BusinessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleBusinessException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">errorCode</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">();</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">errorCode</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">errorCode</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()));</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 그 밖에 발생하는 모든 예외 처리, Null Point Exception 등
    * 개발자가 직접 핸들링해서 다른 예외로 던지지 않으면 발생
    */</span>
   <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
   <span class="kd">protected</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleException</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"handleException"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
       <span class="kd">final</span> <span class="nc">ErrorResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">response</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>ErrorCode는 ErrorResponse 클래스에 저장되는 예외 메시지 관련 데이터 중 예외 코드에 대한 사용자 정의 enum 클래스다.<li>ErrorCode는 HTTP 상태 코드, 에러 코드, 에러 메시지로 구성되며 추후 예외가 추가 되면 에러 코드를 추가할 예정이다.<li>예외가 발생할 때 사용자에게 전달하는 예외 관련 데이터는 크게 두 가지 종류로 분류할 수 있다. 해당 데이터는 유효성 검사에 실패한 경우 클라이언트에 에러 메시지로(json 자료형이 아님) 전달된다.<li>첫 번째는 새로운 예외가 발생할 때 생성자를 통해 예외 메시지를 초기화 하는 방법이다.(new Exception(“Error message”);) 해당 메시지를 json 자료형으로 형변환 하면, 에러 메시지를 errors 배열에서 확인할 수 있다.<li>두 번째는 ErrorResponse의 ErrorCode enum 자료형을 통해 에러 메시지 데이터에 의해서 초기화 된다. 해당 메시지를 json 자료형으로 형변환 하면, 에러 메시지를 message json에서 확인할 수 있다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">error</span><span class="o">/</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.error</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonFormat</span><span class="o">;</span>

<span class="nd">@JsonFormat</span><span class="o">(</span><span class="n">shape</span> <span class="o">=</span> <span class="nc">JsonFormat</span><span class="o">.</span><span class="na">Shape</span><span class="o">.</span><span class="na">OBJECT</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ErrorCode</span> <span class="o">{</span>

   <span class="c1">// Common</span>
   <span class="no">INVALID_INPUT_VALUE</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="s">"C001"</span><span class="o">,</span> <span class="s">"The input value is invalid."</span><span class="o">),</span>
   <span class="no">INVALID_TYPE_VALUE</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="s">"C002"</span><span class="o">,</span> <span class="s">" Invalid Type Value."</span><span class="o">),</span>
   <span class="no">METHOD_NOT_ALLOWED</span><span class="o">(</span><span class="mi">405</span><span class="o">,</span> <span class="s">"C003"</span><span class="o">,</span> <span class="s">" The Method is not allowed."</span><span class="o">),</span>
   <span class="no">HANDLE_ACCESS_DENIED</span><span class="o">(</span><span class="mi">403</span><span class="o">,</span> <span class="s">"C004"</span><span class="o">,</span> <span class="s">"Access is Denied."</span><span class="o">),</span>
   <span class="no">INTERNAL_SERVER_ERROR</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="s">"C005"</span><span class="o">,</span> <span class="s">"Internal Server Error."</span><span class="o">),</span>

   <span class="c1">// File</span>
   <span class="no">FILE_SIZE_ERROR</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="s">"F001"</span><span class="o">,</span> <span class="s">"The file size must be less than 20 MB."</span><span class="o">),</span>
   <span class="no">FILE_TYPE_ERROR</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="s">"F002"</span><span class="o">,</span> <span class="s">"The file type is supposed to dangerous and malicious."</span><span class="o">),</span>

   <span class="c1">// User</span>
   <span class="no">INVALID_USERNAME</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="s">"U001"</span><span class="o">,</span> <span class="s">"The ID is duplicated or ID can be used for more than 6 characters and less than 16 characters."</span><span class="o">)</span>

   <span class="o">;</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

   <span class="nc">ErrorCode</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">status</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">code</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">message</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>ErrorResponse 클래스는 예외 메시지 관련 데이터를 저장하는 클래스다.<li>전달되는 파라미터에 따라 다양한 경우의 클래스를 초기화 하기 위한 생성자와 메소드로 구성된다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">error</span><span class="o">/</span><span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.error</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.AccessLevel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.annotation.MethodArgumentTypeMismatchException</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorResponse</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="n">errors</span><span class="o">;</span>

   <span class="kd">private</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
       <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
       <span class="k">this</span><span class="o">.</span><span class="na">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">getMessage</span><span class="o">();</span>
       <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
       <span class="k">this</span><span class="o">.</span><span class="na">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
       <span class="k">this</span><span class="o">.</span><span class="na">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorResponse</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="nc">FieldError</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">bindingResult</span><span class="o">));</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorResponse</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">code</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorResponse</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorResponse</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">ErrorCode</span> <span class="n">code</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">errors</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorResponse</span> <span class="nf">of</span><span class="o">(</span><span class="nc">MethodArgumentTypeMismatchException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">final</span> <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
       <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">FieldError</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="nc">ErrorResponse</span><span class="o">.</span><span class="na">FieldError</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">());</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_TYPE_VALUE</span><span class="o">,</span> <span class="n">errors</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Getter</span>
   <span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FieldError</span> <span class="o">{</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">field</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">reason</span><span class="o">;</span>

       <span class="kd">private</span> <span class="nf">FieldError</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">field</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">value</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">this</span><span class="o">.</span><span class="na">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">;</span>
           <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
           <span class="k">this</span><span class="o">.</span><span class="na">reason</span> <span class="o">=</span> <span class="n">reason</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">field</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">value</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
           <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="n">fieldErrors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
           <span class="n">fieldErrors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">FieldError</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">reason</span><span class="o">));</span>
           <span class="k">return</span> <span class="n">fieldErrors</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="kd">private</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldError</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="o">{</span>
           <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">FieldError</span><span class="o">&gt;</span> <span class="n">fieldErrors</span> <span class="o">=</span> <span class="n">bindingResult</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">();</span>
           <span class="k">return</span> <span class="n">fieldErrors</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">FieldError</span><span class="o">(</span>
                           <span class="n">error</span><span class="o">.</span><span class="na">getField</span><span class="o">(),</span>
                           <span class="n">error</span><span class="o">.</span><span class="na">getRejectedValue</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="n">error</span><span class="o">.</span><span class="na">getRejectedValue</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span>
                           <span class="n">error</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">()))</span>
                   <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
       <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>BussinessException 클래스는 사용자 정의 예외다.<li>비즈니스 로직에서 예외가 발생하는 경우 예외 메시지 관련 데이터를 초기화하기 위한 생성자가 있다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">exception</span><span class="o">/</span><span class="nc">BusinessException</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorCode</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BusinessException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="nc">ErrorCode</span> <span class="n">errorCode</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">BusinessException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nf">BusinessException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">ErrorCode</span> <span class="n">errorCode</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
       <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nf">BusinessException</span><span class="o">(</span><span class="nc">ErrorCode</span> <span class="n">errorCode</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">(</span><span class="n">errorCode</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
       <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">ErrorCode</span> <span class="nf">getErrorCode</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">errorCode</span><span class="o">;</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>FileTypeException 클래스는 사용자 정의 예외다.<li>파일 유효성 검사에서 예외가 발생하는 경우 예외 메시지 관련 데이터를 초기화하기 위한 생성자가 있다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">exception</span><span class="o">/</span><span class="nc">FileTypeException</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.exception</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileTypeException</span> <span class="kd">extends</span> <span class="nc">BusinessException</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="nf">FileTypeException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>InvalidUsernameException 클래스는 사용자 정의 예외다.<li>사용자 로그인시 ID가 유효하지 않아 예외가 발생하는 경우 예외 메시지 관련 데이터를 초기화하기 위한 생성자가 있다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">exception</span><span class="o">/</span><span class="nc">InvalidUsernameException</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.error.ErrorCode</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InvalidUsernameException</span> <span class="kd">extends</span> <span class="nc">BusinessException</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="nf">InvalidUsernameException</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_USERNAME</span><span class="o">);</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>서버에서 예외 처리하여 사용자에게 전달된 에러 메시지를 View에서 parsing 하여 출력하는 함수다.</ul><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">module</span><span class="o">-</span><span class="nx">app</span><span class="o">-</span><span class="nx">web</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="o">/</span><span class="nx">resources</span><span class="o">/</span><span class="kd">static</span><span class="sr">/js/</span><span class="nx">validation</span><span class="p">.</span><span class="nx">js</span><span class="o">&gt;</span>

<span class="cm">/*
* validation response message alert
*/</span>
<span class="kd">function</span> <span class="nx">paraseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">parseMsg</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">alertMsg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">(</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">parseMsg</span><span class="p">.</span><span class="nx">errors</span><span class="p">))</span> <span class="p">{</span>
       <span class="nx">alertMsg</span> <span class="o">=</span> <span class="nx">parseMsg</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="nx">alertMsg</span> <span class="o">=</span> <span class="nx">parseMsg</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\n</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">parseMsg</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">reason</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="nx">alert</span><span class="p">(</span><span class="nx">alertMsg</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>Javsacript: 객체가 비어있는지 확인하는 함수다.</ul><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">module</span><span class="o">-</span><span class="nx">app</span><span class="o">-</span><span class="nx">web</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="o">/</span><span class="nx">resources</span><span class="o">/</span><span class="kd">static</span><span class="sr">/js/u</span><span class="nx">til</span><span class="p">.</span><span class="nx">js</span><span class="o">&gt;</span>

<span class="cm">/* 객체 empty 여부 반환 */</span>
<span class="kd">function</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span>
           <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>ajax를 통하여 요청하는 경우 에러가 발생하여 에러 메시지를 받는다면, parseErrorMsg 함수를 통하여 받은 메시지를 사용자에게 alert 경고창으로 알려준다.</ul><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="nx">module</span><span class="o">-</span><span class="nx">app</span><span class="o">-</span><span class="nx">web</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="o">/</span><span class="nx">resources</span><span class="o">/</span><span class="nx">templates</span><span class="o">/</span><span class="nx">noticeBoard</span><span class="o">/</span><span class="nx">form</span><span class="p">.</span><span class="nx">html</span><span class="o">&gt;</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
   <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://localhost:8081/api/notice-boards/attachedFile</span><span class="dl">"</span><span class="p">,</span>
   <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
   <span class="na">data</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
   <span class="na">dataType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
   <span class="na">enctype</span><span class="p">:</span> <span class="dl">'</span><span class="s1">multipart/form-data</span><span class="dl">'</span><span class="p">,</span>
   <span class="na">processData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="na">contentType</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="na">async</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span>
   <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/notice-board?idx=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">noticeBoardIdx</span><span class="p">;</span>
   <span class="p">})</span>
   <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">paraseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Update attached file is fail.</span><span class="dl">"</span><span class="p">);</span>
       <span class="nx">deleteNoticeBoard</span><span class="p">(</span><span class="nx">noticeBoardIdx</span><span class="p">);</span>
   <span class="p">});</span>
</pre></table></code></div></div><h2 id="프로젝트-실행-및-결과">프로젝트 실행 및 결과</h2><ul><li>벡엔드에서 title(@NotBlank)의 유효성 검사에 실패할 때 다음 이미지와 같이 응답 메시지를 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-23-Project Lab15/image1.png" alt="image" /></p><p><br /></p><ul><li>벡엔드에서 title(@NotBlank)의 유효성 검사에 실패할 때 다음 이미지와 같이 응답 메시지를 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-23-Project Lab15/image2.png" alt="image" /></p><p><br /></p><ul><li>20 MB 보다 큰 파일을 업로드 할 때 유효성 검사에 실패할 때 발생하는 에러 메시지다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-23-Project Lab15/image3.png" alt="image" /></p><p><br /></p><ul><li>파일 MimeType 유효성 검사와 파일 확장가 검사에 실패하여 발생하는에러 메시지다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-23-Project Lab15/image4.png" alt="image" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a>, <a href='/categories/project-lab/'>Project Lab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Project Lab 15. 유효성 검사(javascript) - 1 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab15/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Project Lab 15. 유효성 검사(javascript) - 1 - 끄적이판&u=https://scribnote5.github.io/posts/Project-Lab15/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Project Lab 15. 유효성 검사(javascript) - 1 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab15/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/MISRA-C3/">함수 호출 인자 및 함수 매개변수의 한정자 관계</a><li><a href="/posts/Project-SW-Test-Forum17/">Project SW Test Forum 17. 유지보수 - 5</a><li><a href="/posts/Project-SW-Test-Forum16/">Project SW Test Forum 16. 유지보수 - 4</a><li><a href="/posts/MISRA-C-02-03/">MISRA C 2012_02_03 - 사용하지 않는 자료형 선언 제거</a><li><a href="/posts/MISRA-C-02-04/">MISRA C 2012_02_04 - 사용하지 않는 태그(struct, union, enum) 선언 제거</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Project-Lab0/"><div class="card-body"> <span class="timeago small" >Apr 14, 2020<i class="unloaded">2020-04-14T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 0. 연구실 홈페이지 개발 프로젝트 소개</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트를 소개한다. 계기 대학원 재학 중일 때 노후화된 연구실 홈페이지 유지보수를 담당하였다. 연구실 홈페이지는 난잡하게 개발되어 있었고 관련 문서가 하나도 없었기에 유지보수에 큰 어려움을 겪었다. 과거 회사 재직 중일 때 Spring을 사용하여 업무 시스템을 개발한 경험이 있다. 당시 초급 개발자로서 요구사항...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-1/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-1. 개발 환경 구축(IntelliJ)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 인텔리제이 개발 환경 구축 과정을 소개한다. 이클립스를 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 IntelliJ Ultimate 2021.1 프로젝...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-2/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-2. 개발 환경 구축(Eclipse)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 이클립스 개발 환경 구축 과정을 소개한다. 인텔리제이 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 Spring Tools 4 for Eclipse(sts...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Project-Lab14/" class="btn btn-outline-primary" prompt="Older"><p>Project Lab 14. 유효성 검사(javascript) - 1</p></a> <a href="/posts/Project-Lab16/" class="btn btn-outline-primary" prompt="Newer"><p>Project Lab 16. UI 변경(Front-end) 및 코드 리펙토링 - 1</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://scribnote5.github.io/posts/Project-Lab15/'; this.page.identifier = '/posts/Project-Lab15/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://scribnote5-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/scribnote5">scribnote5</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
