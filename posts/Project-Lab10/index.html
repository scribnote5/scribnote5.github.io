<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Project Lab 10. 로그인 구현(Spring Security) - 1" /><meta property="og:locale" content="en" /><meta name="description" content="Spring Sercurity를 사용하여 로그인 기능 구현 개발 과정을 소개한다." /><meta property="og:description" content="Spring Sercurity를 사용하여 로그인 기능 구현 개발 과정을 소개한다." /><link rel="canonical" href="https://scribnote5.github.io/posts/Project-Lab10/" /><meta property="og:url" content="https://scribnote5.github.io/posts/Project-Lab10/" /><meta property="og:site_name" content="끄적이판" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-23T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Project Lab 10. 로그인 구현(Spring Security) - 1" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Spring Sercurity를 사용하여 로그인 기능 구현 개발 과정을 소개한다.","url":"https://scribnote5.github.io/posts/Project-Lab10/","headline":"Project Lab 10. 로그인 구현(Spring Security) - 1","@type":"BlogPosting","dateModified":"2021-04-27T00:00:00+09:00","datePublished":"2020-08-23T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://scribnote5.github.io/posts/Project-Lab10/"},"@context":"https://schema.org"}</script><title>Project Lab 10. 로그인 구현(Spring Security) - 1 | 끄적이판</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="끄적이판"><meta name="application-name" content="끄적이판"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/banners/home.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">끄적이판</a></div><div class="site-subtitle font-italic">지금까지 공부한 것을 끄적이는 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/scribnote5" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['scribnote5','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/daeyoung-song-175486167" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Project Lab 10. 로그인 구현(Spring Security) - 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Project Lab 10. 로그인 구현(Spring Security) - 1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> scribnote5 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 23, 2020, 12:00 AM +0900" >Aug 23, 2020<i class="unloaded">2020-08-23T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Apr 27, 2021, 12:00 AM +0000" >Apr 27, 2021<i class="unloaded">2021-04-27T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6103 words">33 min read</span></div></div><div class="post-content"><ul><li><p>Spring Sercurity를 사용하여 로그인 기능 구현 개발 과정을 소개한다.</p><li>github: <a href="https://github.com/scribnote5/lab">https://github.com/scribnote5/lab</a><li><p>github commit: <a href="https://github.com/scribnote5/lab/commit/566099ff988532cec4f6a0466d158d95258b8d9f">https://github.com/scribnote5/lab/commit/566099ff988532cec4f6a0466d158d95258b8d9f</a></p><li>최신 프로젝트 코드와 형상이 다를 수 있습니다. 게시글 코드는 참고만 하시되, 최신 코드는 github에서 확인 부탁드립니다.</ul><h2 id="spring-security">Spring Security</h2><ul><li>Spring Sercurity는 스프링 기반의 어플리케이션의 보안(인증과 권한, 인가 등)을 담당하는 스프링의 하위 프레임워크이다. 보안 관련하여 다양한 옵션을 제공한다.<li>해당 이미지는 Spring Security 인증 아키텍처이며, Spring Security를 이해하기 위한 자세한 설명은 하단 출처를 참고하였다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-08-23-Project Lab10/image1.png" alt="image" /></p><p>출처: <a href="https://sjh836.tistory.com/165">https://sjh836.tistory.com/165</a> <br /> <a href="https://webfirewood.tistory.com/m/115?category=694472">https://webfirewood.tistory.com/m/115?category=694472</a></p><h2 id="로그인-구현-및-설계">로그인 구현 및 설계</h2><ul><li>Spring Security를 사용하여 로그인에 필요한 전반적인 기능(파일 업로드를 제공하는 사용자 CRUD 페이지, 권한, 로그아웃, 로그인 실패시 메시지 출력 등)들을 구현하였다.<li>Spring Security 관련 기능들은 하단 출처를 주로 참고하여 개발하였다.<li>본 프로젝트에서는 Spring Security Session을 사용하여서 로그인을 구현하였다. 로그인 기능 관련 최신 트렌드는 Session 방식이 아니라 JWT(JSON WEB TOKEN) 방식이다. JWT는 Session 보다 서버의 부하를 줄일 수 있는 방식으로 추후 프로젝트 개발할 때 JWT 방식을 사용할 예정이다.</ul><p>출처: <a href="https://victorydntmd.tistory.com/328">https://victorydntmd.tistory.com/328</a><br /> <a href="https://ict-nroo.tistory.com/118">https://ict-nroo.tistory.com/118</a></p><h2 id="권한-종류">권한 종류</h2><ul><li><p>프로젝트에서 분류한 권한 종류는 다음과 같다.</p><li>root: 모든 권한에 대한 접근 허용, 특정 경로(admin 페이지) 접근 가능<li>manager: general 권한에 대한 접근 허용, 본인이 create한 게시글에 update 및 delete 가능<li>general: 본인이 create한 게시글에 update 및 delete 가능<li>non_user: 비회원으로서, 게시글 read만 가능<li>anonymous: 게시글 read만 가능</ul><h2 id="spring-sercurity와-h2-console-같이-사용하기">Spring Sercurity와 H2-console 같이 사용하기</h2><ul><li>Spring Security를 적용한 프로젝트에서 H2-DB를 같이 사용하기 위해서는 부가적인 보안 설정이 필요하다.<li>자세한 설정은 하단 출처를 참고하였다.</ul><p>출처: <a href="https://github.com/HomoEfficio/dev-tips/blob/master/Spring%20Security%EC%99%80%20h2-console%20%ED%95%A8%EA%BB%98%20%EC%93%B0%EA%B8%B0.md">https://github.com/HomoEfficio/dev-tips/blob/master/Spring%20Security%EC%99%80%20h2-console%20%ED%95%A8%EA%BB%98%20%EC%93%B0%EA%B8%B0.md</a></p><h2 id="사용자-테이블-설계">사용자 테이블 설계</h2><ul><li>사용자의 정보를 저장하는 테이블을 생성한다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="k">user</span> <span class="k">table</span><span class="o">&gt;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">user</span>
<span class="p">(</span>
   <span class="n">idx</span>                <span class="nb">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
   <span class="n">created_by</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">created_date</span>       <span class="nb">datetime</span>         <span class="k">null</span><span class="p">,</span>
   <span class="n">last_modified_by</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">last_modified_date</span> <span class="nb">datetime</span>         <span class="k">null</span><span class="p">,</span>
   <span class="n">active_status</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">admission_date</span>     <span class="nb">date</span>             <span class="k">null</span><span class="p">,</span>
   <span class="n">authority_type</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">birth_date</span>         <span class="nb">date</span>             <span class="k">null</span><span class="p">,</span>
   <span class="n">contact</span>            <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">email</span>              <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">private_email</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">english_name</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">gender</span>             <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">graduated_date</span>     <span class="nb">date</span>             <span class="k">null</span><span class="p">,</span>
   <span class="n">introduction</span>       <span class="nb">longtext</span>         <span class="k">null</span><span class="p">,</span>
   <span class="n">korean_name</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">username</span>           <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">user_status</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">user_type</span>          <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">messanger_id</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">password</span>           <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">web_page</span>           <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">workplace</span>          <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span>
<span class="p">);</span>
</pre></table></code></div></div><ul><li>사용자의 이미지 파일 업로드시 파일 정보를 저장하는 테이블을 생성한다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">user_attached_file</span> <span class="k">table</span><span class="o">&gt;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">user_attached_file</span> <span class="p">(</span>
   <span class="n">idx</span>               <span class="nb">bigint</span> <span class="n">auto_increment</span>    <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
   <span class="n">created_by</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>    <span class="k">null</span><span class="p">,</span>
   <span class="n">created_date</span>      <span class="nb">datetime</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">file_name</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>    <span class="k">null</span><span class="p">,</span>
   <span class="n">saved_file_name</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>    <span class="k">null</span><span class="p">,</span>
   <span class="n">user_idx</span>          <span class="nb">bigint</span>          <span class="k">null</span><span class="p">,</span>
   <span class="n">file_size</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>    <span class="k">null</span>
<span class="p">);</span>
</pre></table></code></div></div><h2 id="의존성-관리">의존성 관리</h2><ul><li>module-app-web는 view인 thymeleaf에서 spring Security 관련 태그를 사용가능 하도록 thymeleaf-extras-springSecurity5 의존성 라이브러리를 추가하였다.<li>모든 모듈에서 spring-boot-starter-Security 의존성 라이브러리를 사용하도록 변경하였다.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>&lt;build.gradle&gt;

// 프로젝트 개발에 필요한 공통 의존성 라이브러리를 선언한다.
dependencies {
   // spring boot
   implementation "org.springframework.boot:spring-boot-starter-web"
   implementation "org.springframework.boot:spring-boot-starter-data-jpa"
   implementation "org.springframework.boot:spring-boot-starter-Security"
   runtimeOnly "org.springframework.boot:spring-boot-devtools"

...

project(":module-app-web") {
   dependencies {
       compile project(":module-system-common")
       compile project(":module-domain-core")

       implementation "org.springframework.boot:spring-boot-starter-thymeleaf"
       implementation "org.thymeleaf.extras:thymeleaf-extras-springSecurity5"
   }
}

project("module-app-api") {
   dependencies {
       compile project(":module-system-common")
       compile project(":module-domain-core")
       // spring-boot-starter-Security 의존성 라이브러리를 전체 프로젝트로 변경
   }

...
</pre></table></code></div></div><h2 id="spring-security-설정-파일">Spring Security 설정 파일</h2><ul><li>Spring Security 기본 설정을 개발자가 새로 정의한 파일이다.<li>각 설정에 대한 설명은 주석을, 인증 처리를 위한 CORS 관련 설명은 하단 출처를 참고하였다.</ul><h3 id="securityconfigjava에서-설정한-항목">SecurityConfig.java에서 설정한 항목</h3><ul><li>static 디렉터리 파일들을 Spring Security 보안 설정에서 제외<li>페이지 접근 권한 설정<li>비밀번호 암호화(BCryptPasswordEncoder) 라이브러리 사용<li>로그인 및 로그아웃 설정<li>로그인 성공 및 실패시 이를 처리하는 사용자가 정의 예외처리 handelr 등록</ul><p>출처: <a href="https://oddpoet.net/blog/2017/04/27/cors-with-spring-Security/">https://oddpoet.net/blog/2017/04/27/cors-with-spring-Security/</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="nc">SecurityConfig</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.handler.CustomAuthenticationFailureHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.handler.CustomAuthenticationSuccessHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.authentication.AuthenticationManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.config.annotation.web.builders.WebSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.config.annotation.web.configuration.EnableWebSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.crypto.password.PasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.authentication.AuthenticationFailureHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.authentication.AuthenticationSuccessHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.header.writers.frameoptions.WhiteListedAllowFromStrategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.header.writers.frameoptions.XFrameOptionsHeaderWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.util.matcher.AntPathRequestMatcher</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">WebSecurity</span> <span class="n">web</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="c1">// static 디렉터리의 하위 파일 목록은 인증 무시 ( = 항상통과 )</span>
       <span class="n">web</span><span class="o">.</span><span class="na">ignoring</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/css/**"</span><span class="o">,</span> <span class="s">"/js/**"</span><span class="o">,</span> <span class="s">"/imgages/**"</span><span class="o">,</span> <span class="s">"/summernote/**"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
               <span class="c1">// 페이지 권한 설정</span>
               <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/user/list"</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="s">"root"</span><span class="o">)</span>
               <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/h2-console/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span> <span class="c1">// h2-console 접근 허용</span>
               <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
               <span class="o">.</span><span class="na">and</span><span class="o">()</span>
               <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">ignoringAntMatchers</span><span class="o">(</span><span class="s">"/console/**"</span><span class="o">)</span> <span class="c1">// h2-console csrf 제외</span>
               <span class="o">.</span><span class="na">and</span><span class="o">()</span>
               <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">addHeaderWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">XFrameOptionsHeaderWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">WhiteListedAllowFromStrategy</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">))))</span> <span class="c1">// he-console X-Frame-Options 제외</span>
               <span class="o">.</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span>
               <span class="o">.</span><span class="na">and</span><span class="o">()</span>
               <span class="c1">// 로그인 설정</span>
               <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
               <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/user/login"</span><span class="o">)</span>   <span class="c1">// login 페이지 URL</span>
               <span class="c1">// 사용자 정의 handler</span>
               <span class="o">.</span><span class="na">successHandler</span><span class="o">(</span><span class="nc">CustomAuthenticationSuccessHandler</span><span class="o">())</span>
               <span class="o">.</span><span class="na">failureHandler</span><span class="o">(</span><span class="nc">CustomAuthenticationFailureHandler</span><span class="o">())</span>
               <span class="o">.</span><span class="na">defaultSuccessUrl</span><span class="o">(</span><span class="s">"/user/index"</span><span class="o">)</span>   <span class="c1">// login 성공 URL</span>
               <span class="o">.</span><span class="na">permitAll</span><span class="o">()</span>
               <span class="o">.</span><span class="na">and</span><span class="o">()</span>
               <span class="c1">// 로그아웃 설정</span>
               <span class="o">.</span><span class="na">logout</span><span class="o">()</span>
               <span class="o">.</span><span class="na">logoutRequestMatcher</span><span class="o">(</span><span class="k">new</span> <span class="nc">AntPathRequestMatcher</span><span class="o">(</span><span class="s">"/user/logout"</span><span class="o">))</span>
               <span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/user/logout/success"</span><span class="o">)</span>
               <span class="o">.</span><span class="na">invalidateHttpSession</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
               <span class="o">.</span><span class="na">and</span><span class="o">()</span>
               <span class="c1">// 권한이 없는 경우, 403 예외처리 핸들링</span>
               <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">accessDeniedPage</span><span class="o">(</span><span class="s">"/user/permission-denied"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Bean</span>
   <span class="kd">public</span> <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 비밀번호 암호화에 사용될 PasswordEncoder를 BCryptPasswordEncoder로 사용
    * BCryptPasswordEncoder는 해시 뿐만 아니라 Salt를 넣는 작업을 수행하므로, 입력 값이 같음에도 매번 다른 encoded된 값을 반환함
    *
    * @return
    */</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="n">auth</span><span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userService</span><span class="o">).</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="n">passwordEncoder</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 로그인 성공 후 수행하는 handler
    *
    * @return
    */</span>
   <span class="nd">@Bean</span>
   <span class="kd">public</span> <span class="nc">AuthenticationSuccessHandler</span> <span class="nf">CustomAuthenticationSuccessHandler</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomAuthenticationSuccessHandler</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 로그인 실패 후 수행하는 handler
    *
    * @return
    */</span>
   <span class="nd">@Bean</span>
   <span class="kd">public</span> <span class="nc">AuthenticationFailureHandler</span> <span class="nf">CustomAuthenticationFailureHandler</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomAuthenticationFailureHandler</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 개발자가 원하는 시점에 로그인을 할 수 있도록 구현 가능
    *
    * @return
    * @throws Exception
    */</span>
   <span class="nd">@Override</span>
   <span class="nd">@Bean</span>
   <span class="kd">public</span> <span class="nc">AuthenticationManager</span> <span class="nf">authenticationManagerBean</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">authenticationManagerBean</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="handler">Handler</h2><ul><li>로그인 실패 또는 성공시 수행하는 handler를 사용자가 새로 정의한 파일이다.<li>로그인 실패시 실패한 에러 메시와 id를 controller에 전달하며, controller는 다시 로그인 페이지에 전달한다.<li>에러 종류에 따른 에러 메시지는 각 주석을 참고하면 된다.</ul><p>출처: <a href="https://u2ful.tistory.com/35">https://u2ful.tistory.com/35</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">handler</span><span class="o">/</span><span class="nc">CustomAuthenticationFailureHandler</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.Security.authentication.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.AuthenticationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.authentication.AuthenticationFailureHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomAuthenticationFailureHandler</span> <span class="kd">implements</span> <span class="nc">AuthenticationFailureHandler</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthenticationFailure</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">AuthenticationException</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
       <span class="c1">// 로그인 실패시 기능 구현</span>
       <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
       <span class="nc">String</span> <span class="n">errormsg</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

       <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">BadCredentialsException</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">errormsg</span> <span class="o">=</span> <span class="s">"The email or passwords do not match."</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">InternalAuthenticationServiceException</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">errormsg</span> <span class="o">=</span> <span class="s">"The authentication is not processed due to system problem that occured internally."</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">AuthenticationCredentialsNotFoundException</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">errormsg</span> <span class="o">=</span> <span class="s">"The authentication is not found."</span><span class="o">;</span>
       <span class="o">}</span>
       <span class="c1">// 추후 잠금 및 비활성화 기능 구현</span>
       <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">LockedException</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">errormsg</span> <span class="o">=</span> <span class="s">"This user is locked."</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">DisabledException</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">errormsg</span> <span class="o">=</span> <span class="s">"This user is disabled."</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
       <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"errormsg"</span><span class="o">,</span> <span class="n">errormsg</span><span class="o">);</span>

       <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/user/login/fail"</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>로그인 성공시 수행하는 handler로, 추후 admon 페이지가 개발되면 root와 manager 권한을 가진 사용자를 admin 페이지로 redirect 시킬 예정이다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">handler</span><span class="o">/</span><span class="nc">CustomAuthenticationSuccessHandler</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.Authentication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomAuthenticationSuccessHandler</span> <span class="kd">extends</span> <span class="nc">SavedRequestAwareAuthenticationSuccessHandler</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthenticationSuccess</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
       <span class="c1">// 로그인 성공시 기능 구현</span>
       <span class="kd">super</span><span class="o">.</span><span class="na">onAuthenticationSuccess</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">authentication</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="userprincipal">UserPrincipal</h2><ul><li>Spring Security는 UserDetails 인터페이스를 구현한 UserPricipal 클래스에 데이터를 저장한 다음 사용자 인증을 진행한다.<li>사용자가 로그인하는 동안 UserPricipal 클래스를 통하여 데이터를 불러올 수 있다.<li>UserPricipal 클래스의 멤버 변수와 생성자를 변경하면, 사용자가 로그인하는 동안 UserPricipal 클래스가 저장하는 데이터를 변경할 수 있다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">dto</span><span class="o">/</span><span class="nc">UserPrincipal</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.user.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.domain.enums.ActiveStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.enums.AuthorityType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.GrantedAuthority</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.authority.SimpleGrantedAuthority</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.userdetails.UserDetails</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserPrincipal</span> <span class="kd">implements</span> <span class="nc">UserDetails</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kt">long</span> <span class="n">idx</span><span class="o">;</span>
   <span class="nd">@Getter</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">)</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
   <span class="nd">@Getter</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">NONE</span><span class="o">)</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

   <span class="kd">private</span> <span class="nc">String</span> <span class="n">koreanName</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">englishName</span><span class="o">;</span>

   <span class="kd">private</span> <span class="nc">ActiveStatus</span> <span class="n">activeStatus</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">AuthorityType</span> <span class="n">authorityType</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">UserPrincipal</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">setIdx</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getIdx</span><span class="o">());</span>
       <span class="n">setUsername</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
       <span class="n">setPassword</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
       <span class="n">setKoreanName</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getKoreanName</span><span class="o">());</span>
       <span class="n">setEnglishName</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEnglishName</span><span class="o">());</span>
       <span class="n">setActiveStatus</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getActiveStatus</span><span class="o">());</span>
       <span class="n">setAuthorityType</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">()</span> <span class="o">{</span>
       <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

       <span class="k">switch</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">())</span> <span class="o">{</span>
           <span class="k">case</span> <span class="nl">ROOT:</span>
               <span class="n">authorities</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="nc">AuthorityType</span><span class="o">.</span><span class="na">ROOT</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">()));</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">case</span> <span class="nl">MANAGER:</span>
               <span class="n">authorities</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="nc">AuthorityType</span><span class="o">.</span><span class="na">MANAGER</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">()));</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">case</span> <span class="nl">GENERAL:</span>
               <span class="n">authorities</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="nc">AuthorityType</span><span class="o">.</span><span class="na">GENERAL</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">()));</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">default</span><span class="o">:</span>
               <span class="n">authorities</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="nc">AuthorityType</span><span class="o">.</span><span class="na">NON_USER</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">()));</span>
               <span class="k">break</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">authorities</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">username</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAccountNonExpired</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAccountNonLocked</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isCredentialsNonExpired</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getActiveStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">ActiveStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="repository">Repository</h2><ul><li>User에서 사용하는 쿼리다.<li>countByMemberId: 매개변수의 username과 같은 사용자를 모두 검색한다.(username 중복 조회)<li>findAllByUsernameContaining, findAllByKoreanNameContaining, findAllByEmailContaining: username, koreanname, email을 검색할 때 사용하는 메소드다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">repository</span><span class="o">/</span><span class="nc">UserRepository</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.user.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoard</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="nc">Long</span> <span class="nf">countByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>

   <span class="nc">User</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>

   <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findAllByUsernameContaining</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">);</span>

   <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findAllByKoreanNameContaining</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">String</span> <span class="n">koreanName</span><span class="o">);</span>

   <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findAllByEmailContaining</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="service">Service</h2><ul><li>UserDetails 인터페이스를 구현하면 Spring Security에서 해당 인터페이스를 구현한 클래스에서 인증 작업을 수행한다.<li>사용자가 새로 정의한 메소드는 다음과 같다.<li>joinUser: 회원 가입 할 때 사용하는 메소드로, 비밀번호는 암호화하여 DB에 저장한다.<li>loadUserByUsername: 사용자가 새로 정의한 로그인 메소스다. Spring Security가 사용자 인증시 데이터를 저장하는 UserPrincipal 객체를 생성 후 반환한다. 예외 처리는 추후 개발 예정이다.</ul><p>출처: <a href="https://to-dy.tistory.com/86">https://to-dy.tistory.com/86</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="nc">UserService</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.user.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.SearchDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.UserDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.UserPrincipal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.mapper.UserMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.repository.UserRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.util.EmptyUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.userdetails.UserDetails</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.userdetails.UserDetailsService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.userdetails.UsernameNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="kd">implements</span> <span class="nc">UserDetailsService</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">userRepository</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="nf">findUserList</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">SearchDto</span> <span class="n">searchDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">userList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
       <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="n">userDtoList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

       <span class="n">pageable</span> <span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">(),</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">"idx"</span><span class="o">);</span>

       <span class="k">switch</span> <span class="o">(</span><span class="n">searchDto</span><span class="o">.</span><span class="na">getSearchType</span><span class="o">())</span> <span class="o">{</span>
           <span class="k">case</span> <span class="s">"USER_ID"</span><span class="o">:</span>
               <span class="n">userList</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAllByUsernameContaining</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">searchDto</span><span class="o">.</span><span class="na">getKeyword</span><span class="o">());</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">case</span> <span class="s">"KOREAN_NAME"</span><span class="o">:</span>
               <span class="n">userList</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAllByKoreanNameContaining</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">searchDto</span><span class="o">.</span><span class="na">getKeyword</span><span class="o">());</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">case</span> <span class="s">"Email"</span><span class="o">:</span>
               <span class="n">userList</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAllByEmailContaining</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">searchDto</span><span class="o">.</span><span class="na">getKeyword</span><span class="o">());</span>
               <span class="k">break</span><span class="o">;</span>
           <span class="k">default</span><span class="o">:</span>
               <span class="n">userList</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
               <span class="k">break</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="n">userDtoList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PageImpl</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;(</span><span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">userList</span><span class="o">.</span><span class="na">getContent</span><span class="o">()),</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">userList</span><span class="o">.</span><span class="na">getTotalElements</span><span class="o">());</span>

       <span class="k">return</span> <span class="n">userDtoList</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 회원 가입
    *
    * @param userDto
    * @return
    */</span>
   <span class="nd">@Transactional</span>
   <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">joinUser</span><span class="o">(</span><span class="nc">UserDto</span> <span class="n">userDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">// 비밀번호 암호화</span>
       <span class="nc">BCryptPasswordEncoder</span> <span class="n">passwordEncoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">();</span>
       <span class="n">userDto</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">userDto</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>

       <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">userDto</span><span class="o">)).</span><span class="na">getIdx</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="cm">/**
    * 사용자 정의 로그인
    *
    * @param username
    * @return
    * @throws UsernameNotFoundException
    */</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">UsernameNotFoundException</span> <span class="o">{</span>
       <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
       <span class="nc">UserPrincipal</span> <span class="n">userPrincipal</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

       <span class="k">if</span><span class="o">(</span><span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">user</span><span class="o">))</span> <span class="o">{</span>
           <span class="c1">// 추후 변경: 에러 처리</span>
           <span class="k">throw</span> <span class="k">new</span> <span class="nf">UsernameNotFoundException</span><span class="o">(</span><span class="s">"Username is not found"</span><span class="o">);</span>
       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
           <span class="n">userPrincipal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserPrincipal</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">userPrincipal</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">insertUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">getIdx</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findUserByIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>

       <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="nd">@Transactional</span>
   <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">UserDto</span> <span class="n">userDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">User</span> <span class="n">persistUser</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">getOne</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
       <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">userDto</span><span class="o">);</span>

       <span class="n">persistUser</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

       <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">persistUser</span><span class="o">).</span><span class="na">getIdx</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUserByIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">userRepository</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDupulicationUserByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="o">(</span><span class="n">userRepository</span><span class="o">.</span><span class="na">countByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="controller">Controller</h2><ul><li>User(로그인, CRUD 페이지) 관련한 URI 매핑을 담당한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">UserController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.SearchDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.UserDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.UserPrincipal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.dto.mapper.UserMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.service.UserAttachedFileService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.web.PageableDefault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.core.annotation.AuthenticationPrincipal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserAttachedFileService</span> <span class="n">userAttachedFileService</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">UserController</span><span class="o">(</span><span class="nc">UserService</span> <span class="n">userService</span><span class="o">,</span> <span class="nc">UserAttachedFileService</span> <span class="n">userAttachedFileService</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">userAttachedFileService</span> <span class="o">=</span> <span class="n">userAttachedFileService</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Login Index</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/index"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="nc">UserPrincipal</span> <span class="n">userPrincipal</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userDto"</span><span class="o">,</span> <span class="n">userPrincipal</span><span class="o">);</span>

       <span class="k">return</span> <span class="s">"/user/index"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">//Login Page</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">()</span> <span class="o">{</span>

       <span class="k">return</span> <span class="s">"/user/login"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Login Fail</span>
   <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/login/fail"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">loginFail</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">String</span> <span class="n">errormsg</span><span class="o">)</span> <span class="o">{</span>

       <span class="k">return</span> <span class="s">"/user/login"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Logout</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/logout/success"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">logout</span><span class="o">()</span> <span class="o">{</span>

       <span class="k">return</span> <span class="s">"/user/logoutSuccess"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Permission Denied</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/permission-denied"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">permissionDenied</span><span class="o">()</span> <span class="o">{</span>

       <span class="k">return</span> <span class="s">"/user/permission-denied"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// List</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/list"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">noticeBoardList</span><span class="o">(</span><span class="nd">@PageableDefault</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">SearchDto</span> <span class="n">searchDto</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userDtoList"</span><span class="o">,</span> <span class="n">userService</span><span class="o">.</span><span class="na">findUserList</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">searchDto</span><span class="o">));</span>

       <span class="k">return</span> <span class="s">"/user/list"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Form Update</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/form{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">loginForm</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"idx"</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">UserDto</span> <span class="n">userDto</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
       <span class="n">userDto</span> <span class="o">=</span> <span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">findUserByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">));</span>
       <span class="n">userDto</span> <span class="o">=</span> <span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">userDto</span><span class="o">,</span> <span class="n">userAttachedFileService</span><span class="o">.</span><span class="na">findAttachedFileByUserIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">));</span>

       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userDto"</span><span class="o">,</span> <span class="n">userDto</span><span class="o">);</span>

       <span class="k">return</span> <span class="s">"/user/form"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Read</span>
   <span class="nd">@GetMapping</span><span class="o">({</span><span class="s">""</span><span class="o">,</span> <span class="s">"/"</span><span class="o">})</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">noticeBoardRead</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"idx"</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">UserDto</span> <span class="n">userDto</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
       <span class="n">userDto</span> <span class="o">=</span> <span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">findUserByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">));</span>
       <span class="n">userDto</span> <span class="o">=</span> <span class="nc">UserMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">userDto</span><span class="o">,</span> <span class="n">userAttachedFileService</span><span class="o">.</span><span class="na">findAttachedFileByUserIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">));</span>

       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"userDto"</span><span class="o">,</span> <span class="n">userDto</span><span class="o">);</span>

       <span class="k">return</span> <span class="s">"/user/read"</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="restcontroller">RestController</h2><ul><li>회원 가입하는 사용자의 ID의 중복을 확인한다.<li>User를 Create, Update, Delete를 담당하는 메소드는 생략하였다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">UserRestController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="o">...</span>

<span class="nd">@PostMapping</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">postUser</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">UserDto</span> <span class="n">userDto</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// 추후 변경</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">isDupulicationUserByUsername</span><span class="o">(</span><span class="n">userDto</span><span class="o">.</span><span class="na">getUsername</span><span class="o">()))</span> <span class="o">{</span>

   <span class="o">}</span>

   <span class="nc">Long</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">joinUser</span><span class="o">(</span><span class="n">userDto</span><span class="o">);</span>

   <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">idx</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
<span class="o">}</span>


<span class="o">...</span>
</pre></table></code></div></div><h2 id="view">View</h2><ul><li>CSRF(Cross-site request forgery)는 사용자가 자신의 의지와는 무관하게 공격자의 의도한 행위를 특정 웹사이트에 요청하게 하는 공격이다.<li>CSRF 공격을 방지하기 위한 대표적인 방법은 form 페이지에 CSRF 토큰을 사용하는 것이다.<li>View에서 CSRF 토큰을 보내면 Spring Security는 해당 토큰 값을 확인하고, 신뢰할수 있는 form 데이터인지 확인한다.</ul><p>출처: <a href="https://velog.io/@josworks27/CSRF-%EA%B0%9C%EB%85%90">https://velog.io/@josworks27/CSRF-%EA%B0%9C%EB%85%90</a><br /> <a href="https://velog.io/@max9106/Spring-Security-csrf">https://velog.io/@max9106/Spring-Security-csrf</a></p><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">layout</span><span class="err">/</span><span class="na">script.html</span><span class="nt">&gt;</span>

<span class="nt">&lt;script </span><span class="na">th:src=</span><span class="s">"@{/js/jquery.min.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">th:src=</span><span class="s">"@{/js/jquery.serialize-object.min.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">th:src=</span><span class="s">"@{/js/bootstrap.bundle.min.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">th:src=</span><span class="s">"@{/js/fileUtil.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">th:src=</span><span class="s">"@{/summernote/summernote.min.js}"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">th:inline=</span><span class="s">"javascript"</span><span class="nt">&gt;</span>
   <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">csrfToken</span> <span class="o">=</span> <span class="cm">/*[[${_csrf.token}]]*/</span> <span class="kc">null</span><span class="p">;</span>
       <span class="kd">var</span> <span class="nx">csrfHeader</span> <span class="o">=</span> <span class="cm">/*[[${_csrf.headerName}]]*/</span> <span class="kc">null</span><span class="p">;</span>
       <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxSend</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">csrfHeader</span><span class="p">,</span> <span class="nx">csrfToken</span><span class="p">);</span>
       <span class="p">});</span>
   <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>사용자 로그인 페이지다.</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">user</span><span class="err">/</span><span class="na">login.html</span><span class="nt">&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="c">&lt;!-- css --&gt;</span>
   <span class="nt">&lt;th:block</span> <span class="na">th:replace=</span><span class="s">"layout/css.html"</span><span class="nt">&gt;&lt;/th:block&gt;</span>

   <span class="nt">&lt;title&gt;</span>Login<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- header --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;h1&gt;</span>Login<span class="nt">&lt;/h1&gt;</span>
   <span class="nt">&lt;hr&gt;</span>
   <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/user/login"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">th:name=</span><span class="s">"${_csrf.parameterName}"</span> <span class="na">th:value=</span><span class="s">"${_csrf.token}"</span><span class="nt">/&gt;</span>

       <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">th:value=</span><span class="s">"*{username}"</span> <span class="na">placeholder=</span><span class="s">"Enter the Id."</span><span class="nt">&gt;</span>
       <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Enter the passwords."</span><span class="nt">&gt;</span>
       <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"*{errormsg}"</span><span class="nt">&gt;</span> <span class="nt">&lt;/span&gt;</span>
       <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
   <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>사용자가 로그인 후 이동하는 간략한 사용자 정보 확인 페이지다.</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">user</span><span class="err">/</span><span class="na">index.html</span><span class="nt">&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="c">&lt;!-- css --&gt;</span>
   <span class="nt">&lt;th:block</span> <span class="na">th:replace=</span><span class="s">"layout/css.html"</span><span class="nt">&gt;&lt;/th:block&gt;</span>

   <span class="nt">&lt;title&gt;</span>Index<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- header --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"form"</span> <span class="na">id=</span><span class="s">"form"</span> <span class="na">th:object=</span><span class="s">"${userDto}"</span> <span class="na">action=</span><span class="s">"#"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;h1&gt;</span>Index<span class="nt">&lt;/h1&gt;</span>
       <span class="nt">&lt;hr&gt;</span>
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"isAnonymous()"</span> <span class="na">th:href=</span><span class="s">"@{/user/login}"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"isAnonymous()"</span> <span class="na">th:href=</span><span class="s">"@{/user/form}"</span><span class="nt">&gt;</span>Join<span class="nt">&lt;/a&gt;</span>

       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"isAuthenticated()"</span> <span class="na">th:href=</span><span class="s">"@{/user/logout}"</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;</span>
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"isAuthenticated()"</span> <span class="na">th:href=</span><span class="s">"@{'/user?idx='+*{idx}}"</span><span class="nt">&gt;</span>My Information<span class="nt">&lt;/a&gt;</span>

       <span class="nt">&lt;br&gt;</span>
       <span class="nt">&lt;br&gt;</span>
       User Authority:
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"hasAuthority('root')"</span><span class="nt">&gt;</span>root<span class="nt">&lt;/a&gt;</span>
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"hasAuthority('manager')"</span><span class="nt">&gt;</span>manager<span class="nt">&lt;/a&gt;</span>
       <span class="nt">&lt;a</span> <span class="na">sec:authorize=</span><span class="s">"hasAuthority('general')"</span><span class="nt">&gt;</span>gerneral<span class="nt">&lt;/a&gt;</span>


       <span class="nt">&lt;br&gt;</span>
       <span class="nt">&lt;br&gt;</span>
<span class="c">&lt;!--        User Authority Check:--&gt;</span>
<span class="c">&lt;!--        &lt;span sec:authentication="principal.authorities"&gt;&lt;/span&gt;--&gt;</span>
   <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>로그아웃 할 때 이동하는 페이지다.</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">user</span><span class="err">/</span><span class="na">logoutSuccess.html</span><span class="nt">&gt;</span>

<span class="nt">&lt;script&gt;</span>
   <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">You have logged out.</span><span class="dl">"</span><span class="p">);</span>
   <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/user/index</span><span class="dl">"</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>사용자의 권한으로는 접근 불가능한 페이지에 접근하는 경우 이동하는 페이지다.</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">user</span><span class="err">/</span><span class="na">permission-denied.html</span><span class="nt">&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">You do not have permission on this path.</span><span class="dl">"</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>User form 페이지에서 ID 중복을 위한 기능을 ajax로 구현하였다.<li>사용자는 회원 가입 전 ID가 중복되는지 확인 후 회원 가입을 진행해야 한다.(해당 기능은 구현되었으며 추후 세부적으로 개발 예정)</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">user</span><span class="err">/</span><span class="na">form.html</span><span class="nt">&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="c">&lt;!-- css --&gt;</span>
   <span class="nt">&lt;th:block</span> <span class="na">th:replace=</span><span class="s">"layout/css.html"</span><span class="nt">&gt;&lt;/th:block&gt;</span>

   <span class="nt">&lt;title&gt;</span>Member Form<span class="nt">&lt;/title&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- header --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"layout/header::header"</span><span class="nt">&gt;&lt;/div&gt;</span>

...

/* username 중복 검사 */
$("#validationUserId").click(function () {
   $.ajax({
       url: "http://localhost:8081/api/users/validation/username/" + document.getElementsByName("username")[0].value,
       type: "get",
       dataType: "text",
       contentType: "application/json",
       async: false,

       success: function (msg) {
           if (msg == "false") {
               document.getElementById("usernameCheckResult").innerHTML = "This user id is not duplicated.";
               document.getElementById("usernameCheckResult").style.color = "blue";
               usernameVaildation = true;
           } else {
               document.getElementById("usernameCheckResult").innerHTML = "This user id is already in use.";
               document.getElementById("usernameCheckResult").style.color = "red";
               usernameVaildation = false;
           }

       },
       error: function () {
           alert("User id duplicate fail!");
       }
   });
});

...
</pre></table></code></div></div><h2 id="util">Util</h2><ul><li>현재 로그인한 사용자 정보를 가져와 해당 페이지에 접근하는지 판별하는 메소드다.<li>이후 각 페이지 개발이 완료되면 해당 메소드를 사용하여 권한별로 그리고 사용자 아이디 별로 페이지를 접근 가능 여부 기능을 구현할 예정이다.</ul><p>출처: <a href="https://itstory.tk/entry/Spring-Security-%ED%98%84%EC%9E%AC-%EB%A1%9C%EA%B7%B8%EC%9D%B8%ED%95%9C-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0">https://itstory.tk/entry/Spring-Security-%ED%98%84%EC%9E%AC-%EB%A1%9C%EA%B7%B8%EC%9D%B8%ED%95%9C-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0</a><br /> <a href="https://lemontia.tistory.com/602">https://lemontia.tistory.com/602</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="nc">AccessCheck</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.core.Authentication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.GrantedAuthority</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.context.SecurityContextHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UserDetails</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccessCheck</span> <span class="o">{</span>
    <span class="cm">/**
     * [일반적인 상황에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * 비인증 사용자인 경우 접근 불가
     * root: 모든 권한에 대한 접근 허용
     * manager: 생성자가 root인 경우 접근 허용, 로그인한 사용자의 username과 생성자가 같은 경우 접근 허용
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInGeneral</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="nc">GrantedAuthority</span> <span class="n">grantedAuthority</span> <span class="o">:</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">switch</span> <span class="o">(</span><span class="n">grantedAuthority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">())</span> <span class="o">{</span>
                    <span class="c1">// 로그인한 사용자의 권한: root</span>
                    <span class="c1">// -&gt; 접근 가능</span>
                    <span class="k">case</span> <span class="s">"root"</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="s">"manager"</span><span class="o">:</span>
                        <span class="c1">// createdBy: root</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">if</span> <span class="o">(</span><span class="s">"root"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// username authority: MANAGER</span>
                        <span class="c1">// 로그인한 사용자의 username과 username: 다름</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">"manager"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 나머지 조건</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 다름</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * [module-app-admin user에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * 비인증 사용자인 경우 접근 불가
     * root: 모든 권한에 대한 접근 허용
     * manager: 생성자가 root인 경우 접근 허용, 로그인한 사용자의 username과 생성자가 같은 경우 접근 허용
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInModuleAdminUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="nc">GrantedAuthority</span> <span class="n">grantedAuthority</span> <span class="o">:</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">switch</span> <span class="o">(</span><span class="n">grantedAuthority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">())</span> <span class="o">{</span>
                    <span class="c1">// 로그인한 사용자의 권한: root</span>
                    <span class="c1">// -&gt; 접근 가능</span>
                    <span class="k">case</span> <span class="s">"root"</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="s">"manager"</span><span class="o">:</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// username의 권한 general || non_user</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="nf">if</span> <span class="o">((</span><span class="s">"general"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">||</span> <span class="s">"non_user"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// 로그인한 사용자의 username과 username: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 이외</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * [module-app-web user에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * 비인증 사용자인 경우 접근 불가
     * 생성자가 root인 경우 접근 허용
     * 생성자 권한이 MANAGER인 경우 접근 허용
     * 생성자와 사용자 아이디가 같은 경우 접근 허용
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInModuleWebUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="c1">// createdBy: root</span>
            <span class="c1">// username authority: MANAGER</span>
            <span class="c1">// 로그인한 사용자의 username과 username: 같음</span>
            <span class="c1">// -&gt; 접근 가능</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"root"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">)</span> <span class="o">||</span> <span class="s">"MANAGER"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">username</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authenticationUsername</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
            <span class="c1">// -&gt; 접근 가능</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>해당 변수가 문자열인 경우 공백을 제외한 문자열의 길이가 0인지, 객체인 경우 NULL 인지 확인하기 위해 사용하는 Util 메소드다.</ul><p>출처: <a href="https://gun0912.tistory.com/1">https://gun0912.tistory.com/1</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmptyUtil</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
           <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>

       <span class="k">if</span> <span class="o">((</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">String</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(((</span><span class="nc">String</span><span class="o">)</span> <span class="n">obj</span><span class="o">).</span><span class="na">trim</span><span class="o">().</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
           <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
       <span class="o">}</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="o">((</span><span class="nc">Map</span><span class="o">&lt;?,</span> <span class="o">?&gt;)</span> <span class="n">obj</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span>
       <span class="o">}</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="o">((</span><span class="nc">Map</span><span class="o">&lt;?,</span> <span class="o">?&gt;)</span> <span class="n">obj</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span>
       <span class="o">}</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">List</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="o">((</span><span class="nc">List</span><span class="o">&lt;?&gt;)</span> <span class="n">obj</span><span class="o">).</span><span class="na">isEmpty</span><span class="o">();</span>
       <span class="o">}</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Object</span><span class="o">[])</span> <span class="o">{</span>
           <span class="k">return</span> <span class="o">(((</span><span class="nc">Object</span><span class="o">[])</span> <span class="n">obj</span><span class="o">).</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
   <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h2 id="main">main</h2><ul><li>프로젝트 수행시 사용자 정보를 미리 DB에 저장하도록 하였다.<li>사용자 아이디와 비밀번호는 ‘root/123123123’, ‘manager/123123123’, ‘general/123123123’, ‘non_user/123123123’ 다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="nc">ModuleWebApplication</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.domain.enums.ActiveStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.repository.NoticeBoardRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.enums.AuthorityType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.enums.UserType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.Security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.repository.UserRepository</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ModuleWebApplication</span> <span class="o">{</span>
   <span class="nc">BCryptPasswordEncoder</span> <span class="n">passwordEncoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">();</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ModuleWebApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Bean</span>
   <span class="kd">public</span> <span class="nc">CommandLineRunner</span> <span class="nf">runner</span><span class="o">(</span><span class="nc">NoticeBoardRepository</span> <span class="n">noticeBoardRepository</span><span class="o">,</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="o">(</span><span class="n">args</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="cm">/* 게시글 모두 삭제 */</span>
           <span class="cm">/* noticeBoardRepository.deleteAll(); */</span>

           <span class="cm">/* 게시글 등록 */</span>
           <span class="cm">/*
           IntStream.rangeClosed(1, 200).forEach(index -&gt;
               noticeBoardRepository.save(NoticeBoard.builder()
                   .title("게시글" + index)
                   .content("컨텐츠" + index)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build()));
           */</span>

           <span class="cm">/* 사용자 모두 삭제 */</span>
          <span class="cm">/* userRepository.deleteAll(); */</span>

           <span class="cm">/* 사용자 생성 */</span>
           <span class="cm">/* userRepository.save(User.builder()
                   .username("root")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.ROOT)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());

           userRepository.save(User.builder()
                   .username("manager")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.MANAGER)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());

           userRepository.save(User.builder()
                   .username("manager2")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.MANAGER)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());

           userRepository.save(User.builder()
                   .username("general")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.GENERAL)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());

           userRepository.save(User.builder()
                   .username("general2")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.GENERAL)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());

           userRepository.save(User.builder()
                   .username("non_user")
                   .password(passwordEncoder.encode("123123123"))
                   .userType(UserType.PART_TIME_MS)
                   .authorityType(AuthorityType.NON_USER)
                   .activeStatus(ActiveStatus.ACTIVE)
                   .build());
           */</span>
       <span class="o">};</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="프로젝트-수행-결과">프로젝트 수행 결과</h2><ul><li><a href="http://localhost:8080/user/login">http://localhost:8080/user/login</a> 으로 접속하면 로그인 페이지에 접속한다.<li>만약 아이디와 비밀번호가 틀린 경우 하단 이미지 처럼 로그인에 실패하고 에러 메시지를 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-08-23-Project Lab10/image2.png" alt="image" /></p><ul><li>로그인에 성공하면 <a href="http://localhost:8080/user/index">http://localhost:8080/user/index</a> 페이지로 이동한다.<li>해당 페이지에서 사용자의 권한을 확인할 수 있고 다른 페이지로 이동할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-08-23-Project Lab10/image3.png" alt="image" /></p><ul><li>root 권한을 가지고 있지 않는 사용자가 root 권한을 요구하는 <a href="http://localhost:8080/user/list">http://localhost:8080/user/list</a> 페이지에 접근하는 경우, 다음과 같이 경고창이 출력되며 접근할 수 없도록 한다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-08-23-Project Lab10/image4.png" alt="image" /></p><ul><li>다음 이미지는 User의 CRUD 페이지다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-08-23-Project Lab10/image5.png" alt="image" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a>, <a href='/categories/project-lab/'>Project Lab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Project Lab 10. 로그인 구현(Spring Security) - 1 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab10/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Project Lab 10. 로그인 구현(Spring Security) - 1 - 끄적이판&u=https://scribnote5.github.io/posts/Project-Lab10/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Project Lab 10. 로그인 구현(Spring Security) - 1 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab10/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/MISRA-C3/">함수 호출 인자 및 함수 매개변수의 한정자 관계</a><li><a href="/posts/Project-SW-Test-Forum17/">Project SW Test Forum 17. 유지보수 - 5</a><li><a href="/posts/Project-SW-Test-Forum16/">Project SW Test Forum 16. 유지보수 - 4</a><li><a href="/posts/MISRA-C-02-03/">MISRA C 2012_02_03 - 사용하지 않는 자료형 선언 제거</a><li><a href="/posts/MISRA-C-02-04/">MISRA C 2012_02_04 - 사용하지 않는 태그(struct, union, enum) 선언 제거</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Project-Lab0/"><div class="card-body"> <span class="timeago small" >Apr 14, 2020<i class="unloaded">2020-04-14T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 0. 연구실 홈페이지 개발 프로젝트 소개</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트를 소개한다. 계기 대학원 재학 중일 때 노후화된 연구실 홈페이지 유지보수를 담당하였다. 연구실 홈페이지는 난잡하게 개발되어 있었고 관련 문서가 하나도 없었기에 유지보수에 큰 어려움을 겪었다. 과거 회사 재직 중일 때 Spring을 사용하여 업무 시스템을 개발한 경험이 있다. 당시 초급 개발자로서 요구사항...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-1/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-1. 개발 환경 구축(IntelliJ)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 인텔리제이 개발 환경 구축 과정을 소개한다. 이클립스를 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 IntelliJ Ultimate 2021.1 프로젝...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-2/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-2. 개발 환경 구축(Eclipse)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 이클립스 개발 환경 구축 과정을 소개한다. 인텔리제이 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 Spring Tools 4 for Eclipse(sts...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Project-Lab9/" class="btn btn-outline-primary" prompt="Older"><p>Project Lab 9. 게시판 개발(검색) - 6</p></a> <a href="/posts/Project-Lab11/" class="btn btn-outline-primary" prompt="Newer"><p>Project Lab 11. 게시판 개발(JPA Audit) - 7</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://scribnote5.github.io/posts/Project-Lab10/'; this.page.identifier = '/posts/Project-Lab10/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://scribnote5-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/scribnote5">scribnote5</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
