<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Project Lab 12. 게시판 개발(댓글) - 8" /><meta property="og:locale" content="en" /><meta name="description" content="게시글 댓글 개발 과정을 소개한다." /><meta property="og:description" content="게시글 댓글 개발 과정을 소개한다." /><link rel="canonical" href="https://scribnote5.github.io/posts/Project-Lab12/" /><meta property="og:url" content="https://scribnote5.github.io/posts/Project-Lab12/" /><meta property="og:site_name" content="끄적이판" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-01T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Project Lab 12. 게시판 개발(댓글) - 8" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"게시글 댓글 개발 과정을 소개한다.","url":"https://scribnote5.github.io/posts/Project-Lab12/","headline":"Project Lab 12. 게시판 개발(댓글) - 8","@type":"BlogPosting","dateModified":"2021-06-16T00:00:00+09:00","datePublished":"2020-09-01T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://scribnote5.github.io/posts/Project-Lab12/"},"@context":"https://schema.org"}</script><title>Project Lab 12. 게시판 개발(댓글) - 8 | 끄적이판</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="끄적이판"><meta name="application-name" content="끄적이판"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/banners/home.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">끄적이판</a></div><div class="site-subtitle font-italic">지금까지 공부한 것을 끄적이는 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/scribnote5" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['scribnote5','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/daeyoung-song-175486167" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Project Lab 12. 게시판 개발(댓글) - 8</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Project Lab 12. 게시판 개발(댓글) - 8</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> scribnote5 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 1, 2020, 12:00 AM +0900" >Sep 1, 2020<i class="unloaded">2020-09-01T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 16, 2021, 12:00 AM +0000" >Jun 16, 2021<i class="unloaded">2021-06-16T00:00:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4547 words">25 min read</span></div></div><div class="post-content"><ul><li><p>게시글 댓글 개발 과정을 소개한다.</p><li>github: <a href="https://github.com/scribnote5/lab">https://github.com/scribnote5/lab</a><li><p>github commit: <a href="https://github.com/scribnote5/lab/commit/927d3ed72af532b438c7131482bfb09fcf3698d0">https://github.com/scribnote5/lab/commit/927d3ed72af532b438c7131482bfb09fcf3698d0</a></p><li>최신 프로젝트 코드와 형상이 다를 수 있습니다. 게시글 코드는 참고만 하시되, 최신 코드는 github에서 확인 부탁드립니다.</ul><h2 id="댓글-기능-및-구체적인-권한-접근-설계">댓글 기능 및 구체적인 권한 접근 설계</h2><ul><li>사용자의 권한에 따라 댓글을 등록 할 수 있다.<li>general 권한을 가진 사용자가 root 권한을 가진 사용자가 작성한 게시글의 form 페이지의 URI 주소를 유추할 수 있고 접근할 수 있다. 따라서 사용자 권한에 따라 게시판의 create, update, delete 페이지에 접근을 차단하는 기능을 구현하였다.</ul><h2 id="권한-및-계정-정보">권한 및 계정 정보</h2><ul><li>총 4개의 권한이 존재하며, 권한 별로 게시글 및 페이지 접근이 제한된다.<li><p>권한 별 페이지 및 게시글 접근 여부는 다음과 같다.</p><li>프로젝트에서 분류한 권한 종류는 다음과 같다.<li>root: 모든 권한에 대한 접근 허용, 특정 경로(admin 페이지) 접근 가능<li>manager: general 권한에 대한 접근 허용, 본인이 create한 게시글에 update 및 delete 가능<li>general: 본인이 create한 게시글에 update 및 delete 가능<li>non_user: 비회원으로서, 게시글 read만 가능<li>anonymous: 게시글 read만 가능</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-01-Project Lab12/image0.png" alt="image" /></p><h2 id="table-설계">Table 설계</h2><ul><li>프로젝트에서 사용할 댓글 table을 생성한다.</ul><div class="language-sql highlighter-rouge"><div class="code-header"> <span text-data=" Sql "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">notice_board_comment</span><span class="o">&gt;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">notice_board_comment</span>
<span class="p">(</span>
   <span class="n">idx</span>                <span class="nb">bigint</span> <span class="n">auto_increment</span>    <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
   <span class="n">created_by</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">created_date</span>       <span class="nb">datetime</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">null</span><span class="p">,</span>
   <span class="n">last_modified_by</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">last_modified_date</span> <span class="nb">datetime</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">null</span><span class="p">,</span>
   <span class="n">active_status</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>     <span class="k">null</span><span class="p">,</span>
   <span class="n">notice_board_idx</span>   <span class="n">long</span>             <span class="k">null</span><span class="p">,</span>
   <span class="n">content</span>            <span class="nb">longtext</span>         <span class="k">null</span>
<span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">notice_board_comment</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">notice_board_comment</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="domain-및-dto">Domain 및 DTO</h2><ul><li>NoticeBoard Comment에서 사용하는 Domain다.<li>NoticeBoard의 idx를 참조할 수 있는 noticeBoardIdx 멤버 필드가 존재한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">domain</span><span class="o">/</span><span class="nc">NoticeBoardComment</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.domain</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.domain.CommonAudit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.common.domain.enums.ActiveStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardComment</span> <span class="kd">extends</span> <span class="nc">CommonAudit</span> <span class="o">{</span>
   <span class="nd">@Column</span>
   <span class="kd">private</span> <span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">;</span>

   <span class="nd">@Column</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

   <span class="nd">@Builder</span>
   <span class="kd">public</span> <span class="nf">NoticeBoardComment</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">lastModifiedBy</span><span class="o">,</span> <span class="nc">ActiveStatus</span> <span class="n">activeStatus</span><span class="o">,</span> <span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">,</span> <span class="nc">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">setIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
       <span class="n">setCreatedBy</span><span class="o">(</span><span class="n">createdBy</span><span class="o">);</span>
       <span class="n">setLastModifiedBy</span><span class="o">(</span><span class="n">lastModifiedBy</span><span class="o">);</span>
       <span class="n">setActiveStatus</span><span class="o">(</span><span class="n">activeStatus</span><span class="o">);</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardIdx</span> <span class="o">=</span> <span class="n">noticeBoardIdx</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">NoticeBoardComment</span> <span class="n">noticeBoard</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">setActiveStatus</span><span class="o">(</span><span class="n">noticeBoard</span><span class="o">.</span><span class="na">getActiveStatus</span><span class="o">());</span>
       <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">noticeBoard</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>NoticeBoard Comment에서 사용하는 DTO다.<li>새로 등록한 댓글인지 확인하는 isNewIcon 멤버 필드와 사용자 권한에 따라 접근할 수 있는 isAccess 멤버 필드가 존재한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">dto</span><span class="o">/</span><span class="nc">NoticeBoardCommentDto</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.CommonDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardCommentDto</span> <span class="kd">extends</span> <span class="nc">CommonDto</span> <span class="o">{</span>
   <span class="cm">/* CommonDto: JPA Audit */</span>

   <span class="cm">/* 기본 정보 */</span>
   <span class="kd">private</span> <span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

   <span class="cm">/* newIcon */</span>
   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isNewIcon</span><span class="o">;</span>

   <span class="cm">/* 접근 여부 */</span>
   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isAccess</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>NoticeBoard Comment Entity&lt;-&gt;DTO mapping 소스 코드를 생성하는 Mapper 클래스다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">dto</span><span class="o">/</span><span class="n">mapper</span><span class="o">/</span><span class="nc">NoticeBoardCommentMapper</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.dto.mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.mapper.EntityMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardCommentDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mapstruct.Mapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mapstruct.factory.Mappers</span><span class="o">;</span>

<span class="nd">@Mapper</span><span class="o">(</span><span class="n">componentModel</span> <span class="o">=</span> <span class="s">"spring"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">NoticeBoardCommentMapper</span> <span class="kd">extends</span> <span class="nc">EntityMapper</span><span class="o">&lt;</span><span class="nc">NoticeBoardCommentDto</span><span class="o">,</span> <span class="nc">NoticeBoardComment</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="nc">NoticeBoardCommentMapper</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="nc">Mappers</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">NoticeBoardCommentMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="repository">Repository</h2><ul><li>JPA를 사용하여 다음과 같은 쿼리를 작성하였다.<li>findAllByNoticeBoardIdxOrderByCreatedDateDesc: 같은 게시글에 등록된 댓글을 생성일 순서로 내림차순 정렬한다.<li>deleteAllByNoticeBoardIdx: 게시글에 등록된 댓글을 모두 삭제한다.<li>다음 출처를 참고하면 JPA로 대량의 데이터 삭제할 때 성능 문제가 발생한다. 해당 문제를 해결하기 위해서 JPA 대신 QueryDsl로 쿼리를 작성하여 게시글과 연관된 모든 댓글 삭제 기능을 구현하였다.</ul><p>출처: <a href="https://jojoldu.tistory.com/235">https://jojoldu.tistory.com/235</a><br /> <a href="https://derekpark.tistory.com/84">https://derekpark.tistory.com/84</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">repository</span><span class="o">/</span><span class="nc">NoticeBoardCommentRepository</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">NoticeBoardCommentRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">NoticeBoardComment</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="nc">List</span><span class="o">&lt;</span><span class="nc">NoticeBoardComment</span><span class="o">&gt;</span> <span class="nf">findAllByNoticeBoardIdxOrderByCreatedDateDesc</span><span class="o">(</span><span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">);</span>

   <span class="kt">void</span> <span class="nf">deleteAllByNoticeBoardIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><ul><li>QueryDsl를 사용하여 다음과 같은 쿼리를 작성하였다.<li>deleteAllByNoticeBoardIdx: 게시글에 등록된 댓글을 모두 삭제한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">repository</span><span class="o">/</span><span class="nc">NoticeBoardCommentRepositoryImpl</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.transaction.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.QNoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.support.QuerydslRepositorySupport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.querydsl.jpa.impl.JPAQueryFactory</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardCommentRepositoryImpl</span> <span class="kd">extends</span> <span class="nc">QuerydslRepositorySupport</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JPAQueryFactory</span> <span class="n">queryFactory</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">NoticeBoardCommentRepositoryImpl</span><span class="o">(</span><span class="nc">JPAQueryFactory</span> <span class="n">queryFactory</span><span class="o">)</span> <span class="o">{</span>
       <span class="kd">super</span><span class="o">(</span><span class="nc">NoticeBoardComment</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
       <span class="k">this</span><span class="o">.</span><span class="na">queryFactory</span> <span class="o">=</span> <span class="n">queryFactory</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">deleteAllByNoticeBoardIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">QNoticeBoardComment</span> <span class="n">noticeBoardComment</span> <span class="o">=</span> <span class="nc">QNoticeBoardComment</span><span class="o">.</span><span class="na">noticeBoardComment</span><span class="o">;</span>

       <span class="cm">/*
        * DELETE FROM AttachedFile
        * WHERE noticeBoardIdx = 'noticeBoardIdx'
        */</span>
       <span class="k">return</span> <span class="n">queryFactory</span>
               <span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">noticeBoardComment</span><span class="o">)</span>
               <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">noticeBoardComment</span><span class="o">.</span><span class="na">noticeBoardIdx</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">noticeBoardIdx</span><span class="o">))</span>
               <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="service">Service</h2><ul><li>NoticeBoard Comment의 비즈니스 로직이다.<li>findAllByNoticeBoardIdxOrderByCreatedDateDesc: 게시글에 등록된 댓글을 모두 조회하며, 새로 등록된 댓글 여부와 접근 권한을 설정한다.<li>NoticeBoard Comment service 처럼 NoticeBoard service 또한 접근 불가능한 사용자가 게시글에 접근 권한을 설정한다.(해당 내용은 생략되었다.)</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">noticeBoard</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="nc">NoticeBoardCommentService</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.noticeBoard.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.maintenance.dto.mapper.MaintenanceMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardCommentDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.mapper.NoticeBoardCommentMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.repository.NoticeBoardCommentRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.repository.NoticeBoardCommentRepositoryImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.domain.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.user.repository.UserRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.util.AccessCheck</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.util.EmptyUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.util.NewIconCheck</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.transaction.Transactional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardCommentService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardCommentRepository</span> <span class="n">noticeBoardCommentRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardCommentRepositoryImpl</span> <span class="n">noticeBoardCommentRepositoryImpl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">NoticeBoardCommentService</span><span class="o">(</span><span class="nc">NoticeBoardCommentRepository</span> <span class="n">noticeBoardCommentRepository</span><span class="o">,</span> <span class="nc">NoticeBoardCommentRepositoryImpl</span> <span class="n">noticeBoardCommentRepositoryImpl</span><span class="o">,</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardCommentRepository</span> <span class="o">=</span> <span class="n">noticeBoardCommentRepository</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardCommentRepositoryImpl</span> <span class="o">=</span> <span class="n">noticeBoardCommentRepositoryImpl</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userRepository</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">NoticeBoardCommentDto</span><span class="o">&gt;</span> <span class="nf">findAllByNoticeBoardIdxOrderByCreatedDateDesc</span><span class="o">(</span><span class="nc">Long</span> <span class="n">noticeBoardIdx</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">NoticeBoardCommentDto</span><span class="o">&gt;</span> <span class="n">noticeBoardCommentDtoList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="n">noticeBoardCommentDtoList</span> <span class="o">=</span> <span class="nc">NoticeBoardCommentMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toDto</span><span class="o">(</span><span class="n">noticeBoardCommentRepository</span><span class="o">.</span><span class="na">findAllByNoticeBoardIdxOrderByCreatedDateDesc</span><span class="o">(</span><span class="n">noticeBoardIdx</span><span class="o">));</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">NoticeBoardCommentDto</span> <span class="n">noticeBoardCommentDto</span> <span class="o">:</span> <span class="n">noticeBoardCommentDtoList</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// NewIcon 판별</span>
            <span class="n">noticeBoardCommentDto</span><span class="o">.</span><span class="na">setNewIcon</span><span class="o">(</span><span class="nc">NewIconCheck</span><span class="o">.</span><span class="na">isNew</span><span class="o">(</span><span class="n">noticeBoardCommentDto</span><span class="o">.</span><span class="na">getCreatedDate</span><span class="o">()));</span>

            <span class="c1">// 권한 설정</span>
            <span class="c1">// Update: isAccessInGeneral 메소드에 따라 접근 가능 및 불가</span>
            <span class="c1">// 탈퇴 회원은 권한을 general로 설정 후 권한을 검사함</span>
            <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findByUsername</span><span class="o">(</span><span class="n">noticeBoardCommentDto</span><span class="o">.</span><span class="na">getCreatedBy</span><span class="o">());</span>

            <span class="n">noticeBoardCommentDto</span><span class="o">.</span><span class="na">setAccess</span><span class="o">(</span><span class="nc">AccessCheck</span><span class="o">.</span><span class="na">isAccessInGeneral</span><span class="o">(</span><span class="n">noticeBoardCommentDto</span><span class="o">.</span><span class="na">getCreatedBy</span><span class="o">(),</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">user</span><span class="o">)</span> <span class="o">?</span> <span class="s">"general"</span> <span class="o">:</span> <span class="n">user</span><span class="o">.</span><span class="na">getAuthorityType</span><span class="o">().</span><span class="na">getAuthorityType</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">noticeBoardCommentDtoList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">insertNoticeBoardComment</span><span class="o">(</span><span class="nc">NoticeBoardCommentDto</span> <span class="n">noticeBoardCommentDto</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">noticeBoardCommentRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">NoticeBoardCommentMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">noticeBoardCommentDto</span><span class="o">)).</span><span class="na">getIdx</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">updateNoticeBoardComment</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">NoticeBoardCommentDto</span> <span class="n">noticeBoardCommentDto</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">NoticeBoardComment</span> <span class="n">persistNoticeBoardComment</span> <span class="o">=</span> <span class="n">noticeBoardCommentRepository</span><span class="o">.</span><span class="na">getOne</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
        <span class="nc">NoticeBoardComment</span> <span class="n">noticeBoardComment</span> <span class="o">=</span> <span class="nc">NoticeBoardCommentMapper</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">toEntity</span><span class="o">(</span><span class="n">noticeBoardCommentDto</span><span class="o">);</span>

        <span class="n">persistNoticeBoardComment</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">noticeBoardComment</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">noticeBoardCommentRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">persistNoticeBoardComment</span><span class="o">).</span><span class="na">getIdx</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteNoticeBoardCommentByIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">noticeBoardCommentRepository</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAllByNoticeBoardIdx</span><span class="o">(</span><span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">noticeBoardCommentRepositoryImpl</span><span class="o">.</span><span class="na">deleteAllByNoticeBoardIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h2 id="controller">Controller</h2><ul><li>NoticeBoard Comment 관련 클라이언트의 요청을 view로 매핑한다.<li>NoticeBoard service에서 설정한 접근 권한을 바탕으로 접근 불가능한 사용자가 게시글에 접근할 수 없도록 로직을 추가하였다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">web</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">NoticeBoardController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.common.dto.SearchDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardCommentDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardAttachedFileService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardCommentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.web.PageableDefault</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/notice-board"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardController</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardService</span> <span class="n">noticeBoardService</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardAttachedFileService</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardCommentService</span> <span class="n">noticeBoardCommentService</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">NoticeBoardController</span><span class="o">(</span><span class="nc">NoticeBoardService</span> <span class="n">noticeBoardService</span><span class="o">,</span> <span class="nc">NoticeBoardAttachedFileService</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">,</span> <span class="nc">NoticeBoardCommentService</span> <span class="n">noticeBoardCommentService</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardService</span> <span class="o">=</span> <span class="n">noticeBoardService</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardAttachedFileService</span> <span class="o">=</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardCommentService</span> <span class="o">=</span> <span class="n">noticeBoardCommentService</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// List</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/list"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">noticeBoardList</span><span class="o">(</span><span class="nd">@PageableDefault</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nc">SearchDto</span> <span class="n">searchDto</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"noticeBoardDtoList"</span><span class="o">,</span> <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">findNoticeBoardList</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">searchDto</span><span class="o">));</span>

       <span class="k">return</span> <span class="s">"/noticeBoard/list"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Form Update</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/form{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">noticeBoardForm</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"idx"</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">NoticeBoardDto</span> <span class="n">noticeBoardDto</span> <span class="o">=</span> <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">findNoticeBoardByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
       <span class="nc">String</span> <span class="n">returnPage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

       <span class="c1">// 권한 확인</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">noticeBoardDto</span><span class="o">.</span><span class="na">isAccess</span><span class="o">())</span> <span class="o">{</span>
           <span class="n">noticeBoardDto</span> <span class="o">=</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">.</span><span class="na">findAttachedFileByNoticeBoardIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">noticeBoardDto</span><span class="o">);</span>

           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"noticeBoardDto"</span><span class="o">,</span> <span class="n">noticeBoardDto</span><span class="o">);</span>

           <span class="n">returnPage</span> <span class="o">=</span> <span class="s">"/noticeBoard/form"</span><span class="o">;</span>
       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
           <span class="n">returnPage</span> <span class="o">=</span> <span class="s">"/user/permission-denied"</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="k">return</span> <span class="n">returnPage</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="c1">// Read</span>
   <span class="nd">@GetMapping</span><span class="o">({</span><span class="s">""</span><span class="o">,</span> <span class="s">"/"</span><span class="o">})</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">noticeBoardRead</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"idx"</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">NoticeBoardDto</span> <span class="n">noticeBoardDto</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
       <span class="nc">List</span><span class="o">&lt;</span><span class="nc">NoticeBoardCommentDto</span><span class="o">&gt;</span> <span class="n">noticeBoardCommentDtoList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

       <span class="n">noticeBoardDto</span> <span class="o">=</span> <span class="n">noticeBoardService</span><span class="o">.</span><span class="na">findNoticeBoardByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
       <span class="n">noticeBoardDto</span> <span class="o">=</span> <span class="n">noticeBoardAttachedFileService</span><span class="o">.</span><span class="na">findAttachedFileByNoticeBoardIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">noticeBoardDto</span><span class="o">);</span>
       <span class="n">noticeBoardCommentDtoList</span> <span class="o">=</span> <span class="n">noticeBoardCommentService</span><span class="o">.</span><span class="na">findAllByNoticeBoardIdxOrderByCreatedDateDesc</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>

       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"noticeBoardDto"</span><span class="o">,</span> <span class="n">noticeBoardDto</span><span class="o">);</span>
       <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"noticeBoardCommentDtoList"</span><span class="o">,</span> <span class="n">noticeBoardCommentDtoList</span><span class="o">);</span>

       <span class="k">return</span> <span class="s">"/noticeBoard/read"</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="restcontroller">RestController</h2><ul><li>NoticeBoard Comment 관련 클라이언트의 요청을 json 타입으로 응답한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="n">api</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="nc">NoticeBoardCommentRestController</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.domain.NoticeBoardComment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.dto.NoticeBoardCommentDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.ac.univ.noticeBoard.service.NoticeBoardCommentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.DeleteMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PutMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/notice-boards-comments"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardCommentRestController</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">NoticeBoardCommentService</span> <span class="n">noticeBoardCommentService</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">NoticeBoardCommentRestController</span><span class="o">(</span><span class="nc">NoticeBoardCommentService</span> <span class="n">noticeBoardCommentService</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">this</span><span class="o">.</span><span class="na">noticeBoardCommentService</span> <span class="o">=</span> <span class="n">noticeBoardCommentService</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@PostMapping</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">postNoticeBoard</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">NoticeBoardComment</span> <span class="n">noticeBoardComment</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">Long</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">noticeBoardCommentService</span><span class="o">.</span><span class="na">insertNoticeBoardComment</span><span class="o">(</span><span class="n">noticeBoardComment</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">idx</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">"/{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">putNoticeBoard</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"idx"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="nc">NoticeBoardCommentDto</span> <span class="n">noticeBoardCommentDto</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">noticeBoardCommentService</span><span class="o">.</span><span class="na">updateNoticeBoardComment</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">noticeBoardCommentDto</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"{}"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"/{idx}"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">deleteNoticeBoard</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"idx"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">noticeBoardCommentService</span><span class="o">.</span><span class="na">deleteNoticeBoardCommentByIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>

       <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"{}"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="view">View</h2><ul><li>NoticeBoard Comment 관련 화면을 출력한다.<li>사용자의 권한에 따라 댓글을 등록할 수 있고, 수정 및 삭제 할 수 있다.<li>댓글의 ‘Update’ 버튼을 클릭하는 경우 span 태그가 보이지 않고 form 태그가 보여 댓글을 수정할 수 있고, ‘Cancel’ 버튼을 클릭하는 경우 span 태그가 보이고 form 태그가 보이지 않게 된다.</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span text-data=" HTML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
</pre><td class="rouge-code"><pre><span class="nt">&lt;module-app-web</span><span class="err">/</span><span class="na">src</span><span class="err">/</span><span class="na">main</span><span class="err">/</span><span class="na">resources</span><span class="err">/</span><span class="na">templates</span><span class="err">/</span><span class="na">noticeBoard</span><span class="err">/</span><span class="na">read.html</span><span class="nt">&gt;</span>

...
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="c">&lt;!-- css --&gt;</span>
    <span class="nt">&lt;th:block</span> <span class="na">th:replace=</span><span class="s">"layout/css.html"</span><span class="nt">&gt;&lt;/th:block&gt;</span>

    <span class="nt">&lt;title</span> <span class="na">th:text=</span><span class="s">"${@environment.getProperty('title')} + ' | Notice Board Detail'"</span><span class="nt">&gt;&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"page-content-wrapper"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- header --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"layout/header::header"</span><span class="nt">&gt;&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"form"</span> <span class="na">id=</span><span class="s">"form"</span> <span class="na">th:object=</span><span class="s">"${noticeBoardDto}"</span> <span class="na">action=</span><span class="s">"#"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page-header breadcrumbs"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between align-items-center"</span> <span class="na">data-aos=</span><span class="s">"fade-up"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h2&gt;</span>Notice Board Detail<span class="nt">&lt;/h2&gt;</span>
                    <span class="nt">&lt;ol&gt;</span>
                        <span class="nt">&lt;li&gt;</span>Home<span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>Notice Board Detail<span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ol&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"loading"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">th:src=</span><span class="s">"@{/images/loading.gif}"</span> <span class="na">alt=</span><span class="s">"Loading…"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page-content"</span> <span class="na">data-aos=</span><span class="s">"fade-up"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mobile-table-read mt-4"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;colgroup&gt;</span>
                        <span class="nt">&lt;col</span> <span class="na">width=</span><span class="s">"17.5%"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;col</span> <span class="na">width=</span><span class="s">"82.5%"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/colgroup&gt;</span>

                    <span class="c">&lt;!-- Desktop --&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"d-none d-sm-none d-md-none d-lg-table-row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"text-right border-0"</span> <span class="na">colspan=</span><span class="s">"10"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">&gt;</span>Created By: <span class="nt">&lt;/strong&gt;&lt;span</span> <span class="na">th:text=</span><span class="s">"*{createdBy}"</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">&gt;&lt;/span&gt;</span> <span class="ni">&amp;nbsp;&amp;nbsp;&amp;nbsp;</span>
                            <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">&gt;</span>Created Date: <span class="nt">&lt;/strong&gt;&lt;span</span> <span class="na">th:text=</span><span class="s">"*{#temporals.format(createdDate,'yyyy.MM.dd. HH:mm')}"</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">&gt;&lt;/span&gt;</span> <span class="ni">&amp;nbsp;&amp;nbsp;&amp;nbsp;</span>
                            <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">&gt;</span>Views: <span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"*{views}"</span> <span class="na">class=</span><span class="s">"additional-information"</span><span class="nt">/&gt;&lt;/span&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"d-none d-sm-none d-md-none d-lg-table-row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"*{title}"</span><span class="nt">&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>

                    <span class="c">&lt;!-- Mobile --&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"d-print-none d-sm-table-row d-md-table-row d-lg-none d-xl-none d-table-row"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h4</span> <span class="na">th:text=</span><span class="s">"*{title}"</span> <span class="na">class=</span><span class="s">"mobile-title"</span><span class="nt">&gt;&lt;/h4&gt;</span>

                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-right"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"*{createdBy}"</span> <span class="na">class=</span><span class="s">"mobile-additional-information"</span><span class="nt">&gt;&lt;/span&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"*{#temporals.format(createdDate,'yyyy.MM.dd. HH:mm')}"</span> <span class="na">class=</span><span class="s">"mobile-additional-information"</span><span class="nt">&gt;&lt;/span&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"'Views: ' + *{views}"</span> <span class="na">class=</span><span class="s">"mobile-additional-information"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>

                    <span class="c">&lt;!-- Common --&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content ck-content"</span> <span class="na">th:utext=</span><span class="s">"*{content}"</span><span class="nt">&gt;&lt;/div&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"d-none d-sm-none d-md-none d-lg-table-cell"</span><span class="nt">&gt;</span>Uploaded Attached File<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"d-print-none d-sm-inline d-md-inline d-lg-none d-xl-none d-inline mobile-default"</span><span class="nt">&gt;</span>Uploaded Attached File<span class="nt">&lt;/strong&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"attachedFileList"</span> <span class="na">th:each=</span><span class="s">"attachedFile : *{attachedFileList}"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:attr=</span><span class="s">"onclick=|location.href=encodeURI('${@environment.getProperty('module-app-api.address')}/api/attachedFiles/download/${attachedFile.savedFileName}')|"</span>
                                      <span class="na">th:text=</span><span class="s">"${attachedFile.fileName} + ',&amp;nbsp;' + 'File size: ' + ${attachedFile.fileSize}"</span><span class="nt">&gt;&lt;/span&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"10"</span><span class="nt">&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/table&gt;</span>

                <span class="c">&lt;!-- Comment --&gt;</span>
                <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table mt-3"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;colgroup&gt;</span>
                        <span class="nt">&lt;col</span> <span class="na">width=</span><span class="s">"17.5%"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;col</span> <span class="na">width=</span><span class="s">"82.5%"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/colgroup&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">class=</span><span class="s">"sub-item-title"</span><span class="nt">&gt;</span>Comments<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">th:if=</span><span class="s">"${!#strings.equals(#authentication.principal, 'anonymousUser')}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"form-control comment"</span> <span class="na">name=</span><span class="s">"content"</span> <span class="na">id=</span><span class="s">"comment"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary mt-3"</span> <span class="na">id=</span><span class="s">"insertComment"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/button&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">th:if=</span><span class="s">"!${#lists.isEmpty(noticeBoardCommentDtoList)}"</span> <span class="na">class=</span><span class="s">"mt-3"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-hover"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;tr</span> <span class="na">th:each=</span><span class="s">"noticeBoardCommentDto : ${noticeBoardCommentDtoList}"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;td&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${noticeBoardCommentDto.createdBy}"</span><span class="nt">&gt;&lt;/span&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span>
                                <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(noticeBoardCommentDto.createdDate,'yyyy.MM.dd. HH:mm')}"</span> <span class="na">class=</span><span class="s">"comment-additional-information"</span><span class="nt">&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;img</span> <span class="na">th:class=</span><span class="s">"new-icon"</span> <span class="na">th:if=</span><span class="s">"${noticeBoardCommentDto.newIcon}"</span> <span class="na">th:attr=</span><span class="s">"src=@{|/images/new-icon.png|}"</span><span class="nt">/&gt;</span>

                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mt-2"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;span</span> <span class="na">th:id=</span><span class="s">"commentContent + ${noticeBoardCommentDtoStat.index}"</span>
                                          <span class="na">th:utext=</span><span class="s">"${noticeBoardCommentDto.content}"</span>
                                          <span class="na">class=</span><span class="s">"comment"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;/span&gt;</span>
                                    <span class="nt">&lt;textarea</span> <span class="na">th:id=</span><span class="s">"updateCommentContent + ${noticeBoardCommentDtoStat.index}"</span>
                                              <span class="na">th:text=</span><span class="s">"${noticeBoardCommentDto.content}"</span>
                                              <span class="na">class=</span><span class="s">"form-control comment"</span>
                                              <span class="na">style=</span><span class="s">"display: none;"</span>
                                              <span class="na">name=</span><span class="s">"updateContent"</span><span class="nt">&gt;</span>
					                <span class="nt">&lt;/textarea&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                                <span class="nt">&lt;div</span> <span class="na">th:if=</span><span class="s">"${noticeBoardCommentDto.access}"</span> <span class="na">class=</span><span class="s">"mt-3"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-outline-info mr-2"</span>
                                            <span class="na">th:id=</span><span class="s">"displayComment + ${noticeBoardCommentDtoStat.index}"</span>
                                            <span class="na">th:onclick=</span><span class="s">"displayComment([[${noticeBoardCommentDtoStat.index}]])"</span><span class="nt">&gt;</span>
                                        Update
                                    <span class="nt">&lt;/button&gt;</span>
                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-outline-dangIIggdfger"</span>
                                            <span class="na">th:id=</span><span class="s">"deleteComment + ${noticeBoardCommentDtoStat.index}"</span>
                                            <span class="na">th:onclick=</span><span class="s">"deleteComment([[${noticeBoardCommentDto.idx}]], [[${noticeBoardCommentDtoStat.index}]])"</span><span class="nt">&gt;</span>
                                        Delete
                                    <span class="nt">&lt;/button&gt;</span>
                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">style=</span><span class="s">"display:none;"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-outline-primary mr-2"</span>
                                            <span class="na">th:id=</span><span class="s">"updateComment + ${noticeBoardCommentDtoStat.index}"</span>
                                            <span class="na">th:onclick=</span><span class="s">"updateComment([[${noticeBoardCommentDto.idx}]], [[${noticeBoardCommentDto.createdBy}]], [[${noticeBoardCommentDto.activeStatus}]],[[${noticeBoardCommentDtoStat.index}]])"</span><span class="nt">&gt;</span>
                                        Register
                                    <span class="nt">&lt;/button&gt;</span>
                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">style=</span><span class="s">"display:none;"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-outline-danger"</span> <span class="na">th:id=</span><span class="s">"cancelComment + ${noticeBoardCommentDtoStat.index}"</span>
                                            <span class="na">th:onclick=</span><span class="s">"cancelComment([[${noticeBoardCommentDtoStat.index}]])"</span><span class="nt">&gt;</span>
                                        Cancel
                                    <span class="nt">&lt;/button&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;/tr&gt;</span>
                    <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-between mt-4 mb-4"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-auto"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/notice-board/list"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-secondary"</span><span class="nt">&gt;</span>Move to List<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">th:if=</span><span class="s">"*{access}"</span> <span class="na">class=</span><span class="s">"col-auto ml-2"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"'/notice-board/form?idx='+*{idx}"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-info mx-1"</span><span class="nt">&gt;</span>Update<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-danger mx-1"</span> <span class="na">id=</span><span class="s">"delete"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                <span class="c">&lt;!-- input type="hidden" --&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"idx"</span> <span class="na">th:value=</span><span class="s">"*{idx}"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"createdBy"</span> <span class="na">th:if=</span><span class="s">"${!#strings.equals(#authentication.principal, 'anonymousUser')}"</span> <span class="na">th:value=</span><span class="s">"${#authentication.principal.username}"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"lastModifiedBy"</span> <span class="na">th:if=</span><span class="s">"${!#strings.equals(#authentication.principal, 'anonymousUser')}"</span> <span class="na">th:value=</span><span class="s">"${#authentication.principal.username}"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"activeStatus"</span> <span class="na">th:if=</span><span class="s">"${!#strings.equals(#authentication.principal, 'anonymousUser')}"</span> <span class="na">th:value=</span><span class="s">"ACTIVE"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- footer --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"layout/footer::footer"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="c">&lt;!-- script file --&gt;</span>
<span class="nt">&lt;th:block</span> <span class="na">th:replace=</span><span class="s">"layout/script.html"</span><span class="nt">&gt;&lt;/th:block&gt;</span>

<span class="nt">&lt;script </span><span class="na">th:inline=</span><span class="s">"javascript"</span><span class="nt">&gt;</span>
    <span class="nx">sweetalertFire</span><span class="p">(</span><span class="dl">"</span><span class="s2">notice-board</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#delete</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">Confirm</span><span class="p">.</span><span class="nx">fire</span><span class="p">({</span>
            <span class="na">icon</span><span class="p">:</span> <span class="dl">"</span><span class="s2">warning</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Do you want to delete?</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="na">url</span><span class="p">:</span> <span class="nx">moduleAppApiAddress</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/api/notice-boards/</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">delete</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">dataType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">async</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="p">})</span>
                    <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/notice-board/delete-success</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/notice-board/list</span><span class="dl">"</span><span class="p">;</span>
                    <span class="p">})</span>
                    <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">parseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#insertComment</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">jsonData</span> <span class="o">=</span>
            <span class="p">{</span>
                <span class="na">createdBy</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">createdBy</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">lastModifiedBy</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">lastModifiedBy</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">activeStatus</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">activeStatus</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">noticeBoardIdx</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">content</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\n</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;br&gt;</span><span class="dl">"</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1">// duplicate submit check</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">duplicateSubmitCheck</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">url</span><span class="p">:</span> <span class="nx">moduleAppApiAddress</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/api/notice-boards-comments/</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">),</span>
            <span class="na">dataType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">async</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">})</span>
            <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/notice-board/register-success</span><span class="dl">"</span><span class="p">);</span>
                <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/notice-board?idx=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">parseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="nx">duplicateSubmitFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">})</span>
    <span class="p">});</span>

    <span class="kd">function</span> <span class="nx">updateComment</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">createdBy</span><span class="p">,</span> <span class="nx">activeStatus</span><span class="p">,</span> <span class="nx">commentId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">jsonData</span> <span class="o">=</span>
            <span class="p">{</span>
                <span class="na">idx</span><span class="p">:</span> <span class="nx">idx</span><span class="p">,</span>
                <span class="na">createdBy</span><span class="p">:</span> <span class="nx">createdBy</span><span class="p">,</span>
                <span class="na">lastModifiedBy</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">lastModifiedBy</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">activeStatus</span><span class="p">:</span> <span class="nx">activeStatus</span><span class="p">,</span>
                <span class="na">noticeBoardIdx</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
                <span class="na">content</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateContent</span><span class="dl">"</span><span class="p">)[</span><span class="nx">commentId</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\n</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;br&gt;</span><span class="dl">"</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1">// duplicate submit check</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">duplicateSubmitCheck</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">url</span><span class="p">:</span> <span class="nx">moduleAppApiAddress</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/api/notice-boards-comments/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">idx</span><span class="p">,</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">put</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">),</span>
            <span class="na">dataType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">async</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">})</span>
            <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/notice-board/update-success</span><span class="dl">"</span><span class="p">);</span>
                <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/notice-board?idx=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">parseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="nx">duplicateSubmitFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">deleteComment</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">commentId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Confirm</span><span class="p">.</span><span class="nx">fire</span><span class="p">({</span>
            <span class="na">icon</span><span class="p">:</span> <span class="dl">"</span><span class="s2">warning</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Do you want to delete?</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="na">url</span><span class="p">:</span> <span class="nx">moduleAppApiAddress</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/api/notice-boards-comments/</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">idx</span><span class="p">,</span>
                    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">delete</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">dataType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">async</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="p">})</span>
                    <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">result</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/notice-board/delete-success</span><span class="dl">"</span><span class="p">);</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/notice-board?idx=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">idx</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
                    <span class="p">})</span>
                    <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">parseErrorMsg</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">displayComment</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateContent</span><span class="dl">"</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">commentContent</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">displayComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">deleteComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">cancelComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">cancelComment</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateContent</span><span class="dl">"</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">commentContent</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">displayComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">deleteComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">cancelComment</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">index</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><h2 id="util">Util</h2><ul><li>생성자, 권한, 로그인한 사용자의 데이터를 활용하여 사용자 접근 권한을 판별한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">kr</span><span class="o">/</span><span class="n">ac</span><span class="o">/</span><span class="n">univ</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="nc">AccessCheck</span><span class="o">.</span><span class="na">java</span><span class="o">&gt;</span>

<span class="kn">package</span> <span class="nn">kr.ac.univ.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.core.Authentication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.GrantedAuthority</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.context.SecurityContextHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UserDetails</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccessCheck</span> <span class="o">{</span>
    <span class="cm">/**
     * [일반적인 상황에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * root: 모든 권한에 대한 접근 허용, admin 페이지 접근 가능
     * manager: 작성자 권한이 root인 경우 접근 불가, 작성자 권한이 manager인 경우 로그인한 사용자의 username과 작성자가 같은 경우 접근 허용, 작성자 권한이 general인 경우 접근 허용, admin 페이지 접근 가능
     * general: 작성자 권한이 root, manager인 경우 접근 불가, 작성자 권한이 general인 경우 로그인한 사용자의 username과 작성자가 같은 경우 접근 허용
     * non_user: 로그인 불가
     * anonymous: 로그인 불가
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInGeneral</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="nc">GrantedAuthority</span> <span class="n">grantedAuthority</span> <span class="o">:</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">switch</span> <span class="o">(</span><span class="n">grantedAuthority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">())</span> <span class="o">{</span>
                    <span class="c1">// 로그인한 사용자의 권한: root</span>
                    <span class="c1">// -&gt; 접근 가능</span>
                    <span class="k">case</span> <span class="s">"root"</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="s">"manager"</span><span class="o">:</span>
                        <span class="c1">// createdBy: root</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">if</span> <span class="o">(</span><span class="s">"root"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// username authority: MANAGER</span>
                        <span class="c1">// 로그인한 사용자의 username과 username: 다름</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">"manager"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 나머지 조건</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 다름</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * [module-app-admin user에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * 비인증 사용자인 경우 접근 불가
     * root: 모든 권한에 대한 접근 허용
     * manager: 작성자가 root인 경우 접근 허용, 로그인한 사용자의 username과 작성자가 같은 경우 접근 허용
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInModuleAdminUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(!</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="nc">GrantedAuthority</span> <span class="n">grantedAuthority</span> <span class="o">:</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">switch</span> <span class="o">(</span><span class="n">grantedAuthority</span><span class="o">.</span><span class="na">getAuthority</span><span class="o">())</span> <span class="o">{</span>
                    <span class="c1">// 로그인한 사용자의 권한: root</span>
                    <span class="c1">// -&gt; 접근 가능</span>
                    <span class="k">case</span> <span class="s">"root"</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="s">"manager"</span><span class="o">:</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// username의 권한 general || non_user</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="nf">if</span> <span class="o">((</span><span class="s">"general"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">||</span> <span class="s">"non_user"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 로그인한 사용자의 권한: manager</span>
                        <span class="c1">// 로그인한 사용자의 username과 username: 같음</span>
                        <span class="c1">// -&gt; 접근 가능</span>
                        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="c1">// 이외</span>
                        <span class="c1">// -&gt; 접근 불가</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * [module-app-web user에서 사용자 권한에 따른 접근 가능 여부]
     * &lt;p&gt;
     * 비인증 사용자인 경우 접근 불가
     * 작성자가 root인 경우 접근 허용
     * 작성자 권한이 MANAGER인 경우 접근 허용
     * 작성자와 사용자 아이디가 같은 경우 접근 허용
     *
     * @param createdBy
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">isAccessInModuleWebUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">createdBy</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">authorityType</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// 비인증 사용자, 인증이 안된 경우, authentication 객체가 null인 경우</span>
        <span class="c1">// -&gt; 접근 불가</span>
        <span class="k">if</span> <span class="o">(</span><span class="s">"anonymousUser"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">authentication</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">()</span> <span class="o">||</span> <span class="nc">EmptyUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authentication</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserDetails</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">authenticationUsername</span> <span class="o">=</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>

            <span class="c1">// createdBy: root</span>
            <span class="c1">// username authority: MANAGER</span>
            <span class="c1">// 로그인한 사용자의 username과 username: 같음</span>
            <span class="c1">// -&gt; 접근 가능</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"root"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">)</span> <span class="o">||</span> <span class="s">"MANAGER"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authorityType</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">username</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">authenticationUsername</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">// 로그인한 사용자의 username과 createdBy: 같음</span>
            <span class="c1">// -&gt; 접근 가능</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">authenticationUsername</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">createdBy</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="프로젝트-실행-및-결과">프로젝트 실행 및 결과</h2><ul><li>다음 이미지와 같이 게시글에 댓글이 등록된 것을 확인할 수 있다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-01-Project Lab12/image1.png" alt="image" /></p><p><br /></p><ul><li>ID: manager2, 권한: manager인 사용자는 앞서 설명한 권한 설정에 따라 접근할 수 있는 댓글이 다르다.<li>ID: manager2 사용자는 ID: manager 사용자와 ID: root 사용자의 댓글에 접근할 수 없다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-01-Project Lab12/image2.png" alt="image" /></p><p><br /></p><ul><li>만약 비인증 사용자가 ID: root 사용자가 작성한 게시글의 URI(http://localhost:8080/notice-board/form?idx=200 )로 접근하는 경우, 다음 이미지와 같이 접근을 차단한다.<li>이외에도 ID: root가 아닌 사용자가 ID: root 사용자가 작성한 게시글에 접근하는 경우, 접근을 차단한다.</ul><p><img data-proofer-ignore data-src="/assets/img/2020-09-01-Project Lab12/image3.png" alt="image" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a>, <a href='/categories/project-lab/'>Project Lab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Project Lab 12. 게시판 개발(댓글) - 8 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab12/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Project Lab 12. 게시판 개발(댓글) - 8 - 끄적이판&u=https://scribnote5.github.io/posts/Project-Lab12/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Project Lab 12. 게시판 개발(댓글) - 8 - 끄적이판&url=https://scribnote5.github.io/posts/Project-Lab12/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/MISRA-C3/">함수 호출 인자 및 함수 매개변수의 한정자 관계</a><li><a href="/posts/Project-SW-Test-Forum17/">Project SW Test Forum 17. 유지보수 - 5</a><li><a href="/posts/Project-SW-Test-Forum16/">Project SW Test Forum 16. 유지보수 - 4</a><li><a href="/posts/MISRA-C-02-03/">MISRA C 2012_02_03 - 사용하지 않는 자료형 선언 제거</a><li><a href="/posts/MISRA-C-02-04/">MISRA C 2012_02_04 - 사용하지 않는 태그(struct, union, enum) 선언 제거</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Project-Lab0/"><div class="card-body"> <span class="timeago small" >Apr 14, 2020<i class="unloaded">2020-04-14T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 0. 연구실 홈페이지 개발 프로젝트 소개</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트를 소개한다. 계기 대학원 재학 중일 때 노후화된 연구실 홈페이지 유지보수를 담당하였다. 연구실 홈페이지는 난잡하게 개발되어 있었고 관련 문서가 하나도 없었기에 유지보수에 큰 어려움을 겪었다. 과거 회사 재직 중일 때 Spring을 사용하여 업무 시스템을 개발한 경험이 있다. 당시 초급 개발자로서 요구사항...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-1/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-1. 개발 환경 구축(IntelliJ)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 인텔리제이 개발 환경 구축 과정을 소개한다. 이클립스를 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 IntelliJ Ultimate 2021.1 프로젝...</p></div></div></a></div><div class="card"> <a href="/posts/Project-Lab1-2/"><div class="card-body"> <span class="timeago small" >Jul 15, 2020<i class="unloaded">2020-07-15T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Lab 1-2. 개발 환경 구축(Eclipse)</h3><div class="text-muted small"><p> 연구실 홈페이지 개발 프로젝트의 이클립스 개발 환경 구축 과정을 소개한다. 인텔리제이 사용하여 개발 환경을 구축 한다면 ‘Project Lab 1-1. 개발 환경 구축(IntelliJ)’’ 게시글을 참고하면 된다. 개발 환경 Windows 10 64bit jdk11.0.7 Spring Tools 4 for Eclipse(sts...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Project-Lab11/" class="btn btn-outline-primary" prompt="Older"><p>Project Lab 11. 게시판 개발(JPA Audit) - 7</p></a> <a href="/posts/Project-Lab13/" class="btn btn-outline-primary" prompt="Newer"><p>Project Lab 13. 게시판 개발(무한 스크롤) - 9</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://scribnote5.github.io/posts/Project-Lab12/'; this.page.identifier = '/posts/Project-Lab12/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://scribnote5-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/scribnote5">scribnote5</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
